<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Warm Up UK Homes – Contract</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
  :root {
    --black:#000;
    --gold:#d4af37;
    --border:#ccc;
    --bg:#f4f4f4;
  }
  body { font-family: Arial, sans-serif; background:var(--bg); margin:0; padding:12px 0 60px; }
  .top-banner, .bottom-banner {
    background: var(--black);
    color: var(--gold);
    text-align: center;
    padding: 10px 12px;
    font-weight: 700;
    letter-spacing: 0.08em;
  }
  .bottom-banner {
    position: fixed;
    bottom: 0; left: 0; right: 0;
  }
  .wrap { padding: 0 12px 70px; }
  .box { background:#fff; border:1px solid var(--border); padding:10px; margin-bottom:10px; border-radius:6px; }
  input,select,textarea { width:100%; padding:5px; margin-bottom:6px; box-sizing:border-box; border-radius:4px; border:1px solid #ccc; }
  table { width:100%; border-collapse:collapse; }
  th,td { border:1px solid #ddd; padding:5px; font-size:13px; }
  th { background:#f0f0f0; }
  .row { display:flex; gap:6px; }
  .row>div { flex:1; }
  button { padding:6px 10px; border:none; border-radius:4px; background:var(--black); color:#fff; cursor:pointer; }
  button:hover { opacity:.9; }
  #sigCanvas,#waiverSigCanvas { background:#fff; border:1px solid #aaa; width:100%; touch-action:none; border-radius:4px; }
  h3 { margin-top:0; }
</style>
</head>

<body>
<div class="top-banner">WARM UP UK HOMES LIMITED</div>
<div class="wrap">

  <h2 style="margin:10px 0 5px;">Warm Up UK Homes – Contract</h2>
  <p style="margin:0 0 10px;font-size:12px;line-height:1.4;">
    <strong>Fitzwilliam House, Middle Bank, Doncaster, England, DN4 5NG</strong><br>
    Tel: <strong>07470 474 774</strong>
  </p>

  <!-- CLIENT -->
  <div class="box">
    <div class="row">
      <div><label>Client name</label><input id="clientName"></div>
      <div><label>Client phone (WhatsApp)</label><input id="clientPhone" placeholder="07..."></div>
    </div>
    <div class="row">
      <div><label>Address</label><input id="clientAddress"></div>
      <div><label>Postcode</label><input id="clientPostcode"></div>
    </div>
    <div class="row">
      <div><label>Booking agent</label><input id="bookingAgent"></div>
      <div><label>Confirmer</label><input id="confirmer"></div>
    </div>
    <div class="row">
      <div><label>Install date</label><input id="installDate" type="date"></div>
      <div style="display:flex;align-items:center;"><label><input id="startWithin14" type="checkbox" style="width:auto;margin-right:5px;"> Start within 14 days</label></div>
    </div>
  </div>

  <!-- PRODUCTS -->
  <div class="box">
    <h3>Products / Works</h3>
    <table>
      <thead>
        <tr><th>Product</th><th>Qty</th><th>£/Unit</th><th>Unit</th><th>Line £</th></tr>
      </thead>
      <tbody id="itemsBody">
        <!-- 7 visible dropdown rows -->
        <tr><td><select onchange="recalc()"><option>Spray foam removal</option><option>Space wrap</option><option>Fibreglass</option><option>Loft hatch</option><option>Loft ladder</option><option>Loft boarding</option><option>Cavity wall</option></select></td><td><input type="number" value="0" oninput="recalc()"></td><td><input type="number" value="0" oninput="recalc()"></td><td><select onchange="recalc()"><option>job</option><option>item</option><option>m²</option><option>lm</option></select></td><td><input readonly></td></tr>
        <tr><td><select onchange="recalc()"><option>Space wrap</option><option>Spray foam removal</option><option>Fibreglass</option><option>Loft hatch</option><option>Loft ladder</option><option>Loft boarding</option><option>Cavity wall</option></select></td><td><input type="number" value="0" oninput="recalc()"></td><td><input type="number" value="0" oninput="recalc()"></td><td><select onchange="recalc()"><option>job</option><option>item</option><option>m²</option><option>lm</option></select></td><td><input readonly></td></tr>
        <tr><td><select onchange="recalc()"><option>Fibreglass</option><option>Spray foam removal</option><option>Space wrap</option><option>Loft hatch</option><option>Loft ladder</option><option>Loft boarding</option><option>Cavity wall</option></select></td><td><input type="number" value="0" oninput="recalc()"></td><td><input type="number" value="0" oninput="recalc()"></td><td><select onchange="recalc()"><option>job</option><option>item</option><option>m²</option><option>lm</option></select></td><td><input readonly></td></tr>
        <tr><td><select onchange="recalc()"><option>Loft hatch</option><option>Spray foam removal</option><option>Space wrap</option><option>Fibreglass</option><option>Loft ladder</option><option>Loft boarding</option><option>Cavity wall</option></select></td><td><input type="number" value="0" oninput="recalc()"></td><td><input type="number" value="0" oninput="recalc()"></td><td><select onchange="recalc()"><option>job</option><option>item</option><option>m²</option><option>lm</option></select></td><td><input readonly></td></tr>
        <tr><td><select onchange="recalc()"><option>Loft ladder</option><option>Spray foam removal</option><option>Space wrap</option><option>Fibreglass</option><option>Loft hatch</option><option>Loft boarding</option><option>Cavity wall</option></select></td><td><input type="number" value="0" oninput="recalc()"></td><td><input type="number" value="0" oninput="recalc()"></td><td><select onchange="recalc()"><option>job</option><option>item</option><option>m²</option><option>lm</option></select></td><td><input readonly></td></tr>
        <tr><td><select onchange="recalc()"><option>Loft boarding</option><option>Spray foam removal</option><option>Space wrap</option><option>Fibreglass</option><option>Loft hatch</option><option>Loft ladder</option><option>Cavity wall</option></select></td><td><input type="number" value="0" oninput="recalc()"></td><td><input type="number" value="0" oninput="recalc()"></td><td><select onchange="recalc()"><option>job</option><option>item</option><option>m²</option><option>lm</option></select></td><td><input readonly></td></tr>
        <tr><td><select onchange="recalc()"><option>Cavity wall</option><option>Spray foam removal</option><option>Space wrap</option><option>Fibreglass</option><option>Loft hatch</option><option>Loft ladder</option><option>Loft boarding</option></select></td><td><input type="number" value="0" oninput="recalc()"></td><td><input type="number" value="0" oninput="recalc()"></td><td><select onchange="recalc()"><option>job</option><option>item</option><option>m²</option><option>lm</option></select></td><td><input readonly></td></tr>
      </tbody>
    </table>

    <div style="margin-top:10px">
      <div class="row"><div>Subtotal:</div><div><input id="subtotal" readonly></div></div>
      <div class="row"><div>Discount:</div>
        <div class="row" style="gap:3px;">
          <input id="discountVal" value="0" oninput="recalc()">
          <select id="discountType" onchange="recalc()"><option value="amount">£</option><option value="percent">%</option></select>
        </div>
      </div>
      <div class="row"><div><label><input id="vatOn" type="checkbox" checked onchange="recalc()"> VAT 20%</label></div><div><input id="vatAmt" readonly></div></div>
      <div class="row"><div>Deposit:</div><div><input id="deposit" value="0" oninput="recalc()"></div></div>
      <div class="row"><div><b>FINAL TOTAL:</b></div><div><input id="finalTotal" readonly style="font-weight:bold;"></div></div>
    </div>
  </div>

  <!-- NOTES -->
  <div class="box"><h3>Notes</h3><textarea id="notes" rows="4"></textarea></div>

  <!-- SIGNATURES -->
  <div class="box"><h3>Main Signature (Client)</h3><canvas id="sigCanvas" width="300" height="140"></canvas><button onclick="clearSig()">Clear</button><input id="signedBy" placeholder="Signed name"></div>
  <div class="box"><h3>14-Day Cancellation Waiver</h3><p style="font-size:12px">By signing below, the client requests that Warm Up UK Homes commence works within the 14-day cooling-off period and acknowledges that their right to cancel may be reduced or lost once works begin.</p><canvas id="waiverSigCanvas" width="300" height="120"></canvas><button onclick="clearWaiverSig()">Clear waiver signature</button><input id="waiverSignedBy" placeholder="Waiver signed name"></div>

  <!-- PDF / WHATSAPP -->
  <div class="box"><h3>PDF & WhatsApp</h3><button onclick="generatePDF()">Generate PDF</button><input id="pdfLinkBox" readonly placeholder="PDF link appears here"><button onclick="sendWA()">Send to WhatsApp (with PDF link)</button><input id="waLinkBox" readonly><p id="waError" style="color:red;display:none">Add a phone number.</p></div>

</div>
<div class="bottom-banner">WARM UP UK HOMES LIMITED</div>

<script>
function recalc(){
  const rows=document.getElementById("itemsBody").rows;let subtotal=0;
  for(const r of rows){const q=parseFloat(r.cells[1].children[0].value)||0;const p=parseFloat(r.cells[2].children[0].value)||0;const line=q*p;r.cells[4].children[0].value=line?line.toFixed(2):"";subtotal+=line;}
  document.getElementById("subtotal").value="£"+subtotal.toFixed(2);
  let disc=parseFloat(document.getElementById("discountVal").value)||0;const type=document.getElementById("discountType").value;let after=subtotal;if(disc>0){if(type==="percent"){disc=subtotal*(disc/100);}after=Math.max(0,subtotal-disc);}
  let vat=document.getElementById("vatOn").checked?after*0.2:0;document.getElementById("vatAmt").value="£"+vat.toFixed(2);
  const dep=parseFloat(document.getElementById("deposit").value)||0;const final=Math.max(0,after+vat-dep);document.getElementById("finalTotal").value="£"+final.toFixed(2);
  return{subtotal,discount:disc,afterDisc:after,vat,deposit:dep,final};
}

function makeCanvasDrawable(c){const x=c.getContext("2d");x.lineWidth=2;x.lineCap="round";let d=false;function p(e){const r=c.getBoundingClientRect();return e.touches?{x:e.touches[0].clientX-r.left,y:e.touches[0].clientY-r.top}:{x:e.clientX-r.left,y:e.clientY-r.top};}
c.addEventListener("mousedown",e=>{d=true;const m=p(e);x.beginPath();x.moveTo(m.x,m.y);});c.addEventListener("mousemove",e=>{if(!d)return;const m=p(e);x.lineTo(m.x,m.y);x.stroke();});["mouseup","mouseleave"].forEach(v=>c.addEventListener(v,()=>d=false));c.addEventListener("touchstart",e=>{e.preventDefault();d=true;const m=p(e);x.beginPath();x.moveTo(m.x,m.y);},{passive:false});c.addEventListener("touchmove",e=>{e.preventDefault();if(!d)return;const m=p(e);x.lineTo(m.x,m.y);x.stroke();},{passive:false});c.addEventListener("touchend",()=>d=false,{passive:false});return x;}
const sigCtx=makeCanvasDrawable(document.getElementById("sigCanvas"));const waiverCtx=makeCanvasDrawable(document.getElementById("waiverSigCanvas"));
function clearSig(){sigCtx.clearRect(0,0,300,140);}function clearWaiverSig(){waiverCtx.clearRect(0,0,300,120);}

async function generatePDF(){
  const {jsPDF}=window.jspdf;const doc=new jsPDF("p","mm","a4");
  const totals=recalc();const name=document.getElementById("clientName").value||"-";const phone=document.getElementById("clientPhone").value||"-";const addr=(document.getElementById("clientAddress").value||"-")+" "+(document.getElementById("clientPostcode").value||"");const booking=document.getElementById("bookingAgent").value||"-";const confirmer=document.getElementById("confirmer").value||"-";const notes=document.getElementById("notes").value||"-";const signedBy=document.getElementById("signedBy").value||"Pending";const waiverSignedBy=document.getElementById("waiverSignedBy").value||"";const start=document.getElementById("startWithin14").checked;const today=new Date().toISOString().slice(0,10);const contract="WUU-"+today.replace(/-/g,"")+"-"+Math.floor(Math.random()*999);

  doc.setFillColor(0,0,0);doc.rect(0,0,210,20,"F");
  doc.setTextColor(212,175,55);doc.setFontSize(13);doc.text("WARM UP UK HOMES LIMITED",105,12,{align:"center"});
  doc.setFontSize(7);doc.text("Fitzwilliam House, Middle Bank, Doncaster, England, DN4 5NG",105,23,{align:"center"});doc.text("Tel: 07470 474 774",105,27,{align:"center"});doc.setTextColor(0,0,0);

  doc.setDrawColor(200,200,200);doc.rect(10,30,95,30);doc.rect(115,30,85,30);doc.setFontSize(9);doc.text("Client / Property",12,35);doc.text("Job / Internal",117,35);doc.text("Name: "+name,12,41);doc.text("Phone: "+phone,12,46);
  const addrLines=doc.splitTextToSize("Address: "+addr,90);doc.text(addrLines,12,51);doc.text("Booking: "+booking,117,41);doc.text("Confirmer: "+confirmer,117,46);doc.text("Contract: "+contract,117,51);doc.text("Date: "+today,117,56);
  if(start){doc.setTextColor(200,0,0);doc.text("Start inside 14 days",117,61);doc.setTextColor(0,0,0);}

  let y=64;doc.setFillColor(245,245,245);doc.rect(10,y,190,8,"F");doc.setDrawColor(200,200,200);doc.rect(10,y,190,8);doc.text("Description",12,y+5);doc.text("Qty",120,y+5);doc.text("£/Unit",135,y+5);doc.text("Unit",155,y+5);doc.text("Line £",175,y+5);y+=8;
  const rows=document.getElementById("itemsBody").rows;for(const r of
