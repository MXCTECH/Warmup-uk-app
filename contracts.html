<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Warm Up UK Homes — Contract Builder</title>
<style>
  :root{
    --bg:#0f0f0f;
    --panel:#151515;
    --panel-2:#1c1c1c;
    --text:#f2f2f2;
    --muted:#b8b8b8;
    --gold:#d4af37;
    --orange:#ff8c1a;
    --orange-2:#ff9c33;
    --neon:#23ff6a;
    --border:rgba(255,255,255,.08);
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--text);font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:980px;margin:18px auto;padding:0 14px}
  .card{background:linear-gradient(180deg,#201e1a,#15130f);border:1px solid #3a3323;border-radius:16px;padding:16px 16px 18px;margin-bottom:18px;position:relative;overflow:hidden}
  .brand{display:flex;gap:14px;align-items:center}
  #logo{width:58px;height:58px;border-radius:12px;object-fit:cover;background:#000;box-shadow:0 0 0 1px #2a2a2a}
  .title{font-weight:800;font-size:28px;letter-spacing:.02em}
  .sub{color:var(--muted);margin-top:2px}
  .actions{display:flex;gap:12px;margin-top:14px;flex-wrap:wrap}
  .btn{border:1px solid #353535;background:#191919;color:#e9e9e9;padding:12px 16px;border-radius:14px;cursor:pointer}
  .btn.gold{background:var(--gold);color:#1a1a1a;border-color:#7d671d;font-weight:700}
  .section{background:var(--panel);border:1px dashed #3a3a3a;border-radius:16px;padding:16px 14px;margin:14px 0}
  .section h3{margin:2px 6px 12px;font-size:26px;letter-spacing:.04em;color:var(--gold)}
  label{display:block;margin:10px 6px 6px;color:var(--muted);font-size:.95rem}
  input,select,textarea{width:100%;background:#111;border:2px solid var(--orange);border-radius:12px;padding:12px 12px;color:#f5f5f5;outline:none}
  input::placeholder,textarea::placeholder{color:#777}
  textarea{min-height:96px;resize:vertical}
  .grid{display:grid;gap:12px}
  .g2{grid-template-columns:1fr 1fr}
  .g3{grid-template-columns:1.2fr .9fr .9fr .9fr}
  @media (max-width:720px){.g2,.g3{grid-template-columns:1fr}}
  .table-head{display:grid;grid-template-columns:1.2fr .9fr .9fr .9fr;gap:10px;margin:8px 6px;color:#bdbdbd}
  .line{display:grid;grid-template-columns:1.2fr .9fr .9fr .9fr;gap:10px;margin:8px 6px}
  .small{font-size:.9rem;color:#bdbdbd}
  .pill{display:inline-flex;align-items:center;gap:10px;border:1px solid #333;background:var(--panel-2);padding:10px 14px;border-radius:999px;margin:8px 6px}
  .switch{position:relative;width:54px;height:30px;background:#2a2a2a;border-radius:999px;border:1px solid #3a3a3a;flex-shrink:0}
  .switch input{opacity:0;position:absolute;inset:0}
  .knob{position:absolute;top:3px;left:3px;width:24px;height:24px;border-radius:50%;background:#ccc;transition:all .2s ease}
  .switch input:checked + .knob{left:27px;background:var(--neon);box-shadow:0 0 14px 4px rgba(35,255,106,.35)}
  .subtotal{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:10px 6px}
  .box{background:#0f0f0f;border:1px solid #2f2f2f;border-radius:14px;padding:14px}
  .final{background:#0c0c0c;border:2px solid #2d2d2d;border-radius:16px;padding:18px}
  .final.big{display:flex;flex-direction:column;gap:6px;align-items:flex-start}
  .final h4{margin:0;color:#eaeaea}
  .amount{font-size:30px;font-weight:800}
  .flash{animation:glow 1.1s ease-out 1}
  @keyframes glow{
    0%{box-shadow:0 0 0 0 rgba(35,255,106,.0);border-color:#2d2d2d}
    30%{box-shadow:0 0 36px 8px rgba(35,255,106,.45);border-color:#29d96a}
    100%{box-shadow:0 0 0 0 rgba(35,255,106,.0);border-color:#2d2d2d}
  }

  /* Signature pad */
  .sig-wrap{background:var(--panel);border-radius:16px;padding:14px;border:1px dashed #3a3a3a}
  .sig-canvas{width:100%;height:230px;background:#000;border:3px dashed var(--orange);border-radius:14px;touch-action:none}
  .muted{color:#9b9b9b;font-size:.92rem;margin:8px 4px}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="brand">
        <img id="logo" src="assets/warmupuk-logo.png.PNG" alt="Logo"
             onerror="this.style.background='#000';this.style.boxShadow='inset 0 0 0 1px #2a2a2a';this.src='';">
        <div>
          <div class="title">WARM UP UK HOMES</div>
          <div class="sub">Contract Builder</div>
        </div>
      </div>
      <div class="actions">
        <button class="btn gold" id="btnPrint">Save PDF</button>
        <button class="btn" id="btnWhatsApp">WhatsApp</button>
        <button class="btn" id="btnSaveLocal">Save quote to phone</button>
      </div>
    </div>

    <!-- Client -->
    <div class="section">
      <h3>CLIENT &amp; JOB DETAILS</h3>
      <div class="grid">
        <div>
          <label>Contract Number</label>
          <input id="contractNo" placeholder="WUUK-YYYYMMDD-XXXX" />
        </div>
        <div>
          <label>Date</label>
          <input id="date" type="date" />
        </div>
        <div>
          <label>Client name</label>
          <input id="client" placeholder="Full name" />
        </div>
        <div>
          <label>Contact number (WhatsApp)</label>
          <input id="phone" inputmode="tel" placeholder="+44... or 07..." />
        </div>
        <div>
          <label>Property address</label>
          <input id="address" placeholder="Address, Postcode" />
        </div>
      </div>
    </div>

    <!-- Products -->
    <div class="section" id="prodSection">
      <h3>PRODUCTS &amp; PRICING</h3>

      <div class="table-head">
        <div>Product</div><div>Size (m)</div><div>Unit £/m</div><div>Line £</div>
      </div>
      <div id="lines"></div>
      <div style="margin:8px 6px">
        <button class="btn" id="addLine">+ Add line</button>
      </div>

      <div class="pill">
        <span>VAT (20%)</span>
        <label class="switch"><input id="vatOn" type="checkbox" checked><span class="knob"></span></label>
      </div>

      <div class="pill">
        <span>Enable Discount</span>
        <label class="switch"><input id="discOn" type="checkbox"><span class="knob"></span></label>
      </div>

      <div class="grid g2" id="discountBoxes" style="display:none;margin-top:6px">
        <div>
          <label>Discount Before (£)</label>
          <input id="discBefore" type="number" min="0" step="0.01" value="0">
        </div>
        <div>
          <label>Discount After (£)</label>
          <input id="discAfter" type="number" min="0" step="0.01" value="0">
        </div>
      </div>

      <div class="subtotal">
        <div class="box"><div class="small">Subtotal</div><div id="subtotal">£0.00</div></div>
        <div class="box"><div class="small">VAT</div><div id="vat">£0.00</div></div>
      </div>

      <div class="grid g2" style="align-items:stretch">
        <div>
          <label>Deposit (paid / due now)</label>
          <input id="deposit" type="number" min="0" step="0.01" value="0">
        </div>
        <div class="final big" id="finalCard">
          <h4>Final to Pay Today</h4>
          <div class="amount" id="final">£0.00</div>
        </div>
      </div>
    </div>

    <!-- Signature -->
    <div class="section">
      <h3>Signature</h3>
      <div class="sig-wrap">
        <canvas id="sig" class="sig-canvas"></canvas>
        <div class="actions" style="margin-top:10px">
          <button class="btn" id="clearSig">Clear</button>
        </div>
        <div class="muted">Sign inside the black box with your finger (orange ink).</div>
      </div>
    </div>

  </div>

<script>
(function(){
  const £ = (sel, el=document)=>el.querySelector(sel);
  const ££ = (sel, el=document)=>[...el.querySelectorAll(sel)];
  const fmt = n => "£"+(Number(n||0).toFixed(2));

  // --- Contract number + date ---
  function genId(){
    const d = new Date();
    const pad = x => String(x).padStart(2,'0');
    const yyyy = d.getFullYear();
    const mm = pad(d.getMonth()+1);
    const dd = pad(d.getDate());
    const rand = Math.floor(1000+Math.random()*9000);
    return `WUUK-${yyyy}${mm}${dd}-${rand}`;
  }
  $('#contractNo').value = genId();
  $('#date').valueAsDate = new Date();

  // --- Product lines ---
  const lineTpl = () => {
    const row = document.createElement('div');
    row.className = 'line';
    row.innerHTML = `
      <select class="prod">
        <option>Spray Foam Removal</option>
        <option>Ceiling Level Insulation</option>
        <option>Multifoil</option>
      </select>
      <input class="size" type="number" min="0" step="0.1" placeholder="0">
      <input class="unit" type="number" min="0" step="0.01" placeholder="0.00">
      <input class="total" type="text" value="£0.00" readonly>
    `;
    // orange borders
    ££('select,input',row).forEach(i=>{i.style.borderColor='var(--orange)'});
    // live calc
    const recalc = ()=> {
      const size = Number( $('.size',row).value || 0 );
      const unit = Number( $('.unit',row).value || 0 );
      const line = size*unit;
      $('.total',row).value = fmt(line);
      calcTotals();
    };
    £$('.size',row)[0].addEventListener('input', recalc);
    £$('.unit',row)[0].addEventListener('input', recalc);
    return row;
  };

  function addLine(){ $('#lines').appendChild(lineTpl()); }
  $('#addLine').addEventListener('click', addLine);
  // start with one line
  addLine();

  // --- Discount toggle ---
  $('#discOn').addEventListener('change', () => {
    const on = $('#discOn').checked;
    $('#discountBoxes').style.display = on ? 'grid' : 'none';
    calcTotals(true);
  });
  $('#discBefore').addEventListener('input', ()=>calcTotals());
  $('#discAfter').addEventListener('input', ()=>calcTotals());
  $('#deposit').addEventListener('input', ()=>calcTotals());
  $('#vatOn').addEventListener('change', ()=>calcTotals(true));

  // --- Totals ---
  function sumLines(){
    return £$('#lines .line').reduce((t,row)=>{
      const size = Number($('.size',row).value||0);
      const unit = Number($('.unit',row).value||0);
      return t + size*unit;
    },0);
  }

  function calcTotals(flash=false){
    const sub = sumLines();
    const vat = $('#vatOn').checked ? sub*0.20 : 0;
    let discount = 0;
    if($('#discOn').checked){
      const before = Number($('#discBefore').value||0);
      const after  = Number($('#discAfter').value||0);
      discount = Math.max(0, before - after);
    }
    const deposit = Number($('#deposit').value||0);
    const final = Math.max(0, sub + vat - discount - deposit);

    $('#subtotal').textContent = fmt(sub);
    $('#vat').textContent = fmt(vat);
    $('#final').textContent = fmt(final);

    if (flash && $('#discOn').checked){
      const card = $('#finalCard');
      card.classList.remove('flash');
      void card.offsetWidth; // restart animation
      card.classList.add('flash');
    }
  }
  // recalc on any input change globally
  document.addEventListener('input', e=>{
    if (['INPUT','SELECT','TEXTAREA'].includes(e.target.tagName)) calcTotals();
  });

  // --- Signature pad (orange ink on black) ---
  const canvas = $('#sig');
  const ctx = canvas.getContext('2d',{willReadFrequently:true});
  const ratio = Math.max(window.devicePixelRatio||1, 1);
  function resizeCanvas(){
    const rect = canvas.getBoundingClientRect();
    canvas.width = rect.width * ratio;
    canvas.height = rect.height * ratio;
    ctx.scale(ratio, ratio);
    ctx.lineWidth = 2.8;
    ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--orange-2').trim() || '#ff9c33';
    ctx.lineCap = 'round';
  }
  resizeCanvas(); addEventListener('resize', resizeCanvas);

  let drawing=false, last={x:0,y:0};
  const pos = e=>{
    const r = canvas.getBoundingClientRect();
    const t = e.touches ? e.touches[0] : e;
    return {x: (t.clientX - r.left), y: (t.clientY - r.top)};
  }
  const down = e=>{ drawing=true; last=pos(e); e.preventDefault(); }
  const move = e=>{
    if(!drawing) return;
    const p = pos(e);
    ctx.beginPath(); ctx.moveTo(last.x,last.y); ctx.lineTo(p.x,p.y); ctx.stroke();
    last=p; e.preventDefault();
  }
  const up = ()=> drawing=false;

  canvas.addEventListener('mousedown',down);
  canvas.addEventListener('mousemove',move);
  canvas.addEventListener('mouseup',up);
  canvas.addEventListener('mouseleave',up);
  canvas.addEventListener('touchstart',down,{passive:false});
  canvas.addEventListener('touchmove',move,{passive:false});
  canvas.addEventListener('touchend',up);

  $('#clearSig').addEventListener('click',()=>{ctx.clearRect(0,0,canvas.width,canvas.height)});

  // --- Actions ---
  $('#btnPrint').addEventListener('click', ()=>window.print());

  $('#btnWhatsApp').addEventListener('click', ()=>{
    const msg = [
      'WARM UP UK HOMES',
      `Contract: ${$('#contractNo').value}`,
      `Client: ${$('#client').value || '-'}`,
      `Address: ${$('#address').value || '-'}`,
      `Total today: ${$('#final').textContent}`
    ].join('\n');
    // Try share sheet first
    if (navigator.share){
      navigator.share({text: msg}).catch(()=>{});
    }else{
      const u = 'https://wa.me/?text='+encodeURIComponent(msg);
      window.open(u,'_blank');
    }
  });

  $('#btnSaveLocal').addEventListener('click', ()=>{
    const data = {
      id: $('#contractNo').value,
      date: $('#date').value,
      client: $('#client').value,
      phone: $('#phone').value,
      address: $('#address').value,
      lines: £$('#lines .line').map(row=>({
        product: $('.prod',row).value,
        size: $('.size',row).value,
        unit: $('.unit',row).value,
        line: $('.total',row).value
      })),
      vatOn: $('#vatOn').checked,
      discountOn: $('#discOn').checked,
      before: $('#discBefore').value,
      after: $('#discAfter').value,
      deposit: $('#deposit').value,
      subtotal: $('#subtotal').textContent,
      vat: $('#vat').textContent,
      final: $('#final').textContent
    };
    // Save to localStorage
    localStorage.setItem(`wuuk-${data.id}`, JSON.stringify(data));
    // Download a JSON file too
    const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `WUUK-${data.id}.json`;
    document.body.appendChild(a); a.click(); a.remove();
    alert('Quote saved to your phone (JSON) and stored locally.');
  });

  // Initial totals
  calcTotals();
})();
</script>
</body>
</html>
