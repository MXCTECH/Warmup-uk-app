<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>WARM UP UK HOMES — Contract</title>

<style>
:root{
  --bg:#0b0d12; --panel:#121212; --ink:#e7e8ec;
  --muted:#a3a3a3; --gold:#d4af37; --gold-soft:#ffd766;
  --line:#222; --radius:16px; --shadow:0 10px 28px rgba(0,0,0,.55);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  color:var(--ink); background:linear-gradient(180deg,rgba(212,175,55,.14),transparent 240px),var(--bg);
}

/* Sliding banner header */
header{
  position:sticky; top:-72px; z-index:5; backdrop-filter:saturate(120%) blur(4px);
  transition:transform .45s ease, opacity .45s ease; opacity:.98;
}
header.scrolled{ transform:translateY(72px); }
.head{
  background:linear-gradient(180deg,rgba(212,175,55,.18),rgba(0,0,0,.35));
  border:1px solid rgba(212,175,55,.25); border-radius:20px; margin:14px auto 8px;
  max-width:1100px; padding:18px; box-shadow:var(--shadow);
}
.brand{display:flex; align-items:center; gap:12px}
.brand img{height:34px; width:auto; display:block}
.brand h1{font-size:22px; letter-spacing:.18em; margin:0; font-weight:800}
.actions{display:flex; gap:12px; flex-wrap:wrap; margin-top:12px}
.btn{
  appearance:none; border:1px solid rgba(212,175,55,.45); color:#1a1a1a;
  background:linear-gradient(180deg,var(--gold-soft),var(--gold));
  padding:10px 16px; border-radius:999px; font-weight:700; cursor:pointer;
  box-shadow:0 6px 18px rgba(212,175,55,.25); user-select:none;
}
.btn:active{transform:translateY(1px)}
.btn.ghost{
  color:var(--gold); background:transparent; border-color:rgba(212,175,55,.35)
}

/* Main card sections */
.wrap{max-width:1100px; margin:0 auto 120px; padding:0 14px}
.card{
  background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,0));
  border:1px solid #1c1c1c; border-radius:var(--radius); padding:20px; margin:14px 0; box-shadow:var(--shadow)
}
h2{font-size:14px; letter-spacing:.22em; color:var(--gold); text-transform:uppercase; margin:0 0 18px 0}
.row{display:grid; grid-template-columns:1fr; gap:12px}
@media(min-width:680px){ .row{grid-template-columns:1fr 1fr} }
label{font-size:.9rem; color:var(--muted)}
input,select,textarea{
  width:100%; padding:14px 12px; border-radius:10px; border:1px solid var(--line);
  background:#0f1015; color:var(--ink); font-size:16px;
}
textarea{min-height:120px; resize:vertical}

/* Products table */
.table{border:1px dashed #2a2a2a; border-radius:14px; padding:14px}
.grid{display:grid; grid-template-columns: 1fr 90px 140px 140px; gap:10px; align-items:center}
.grid .th{color:var(--muted); font-size:.9rem}
.line{display:contents}
.addline{margin:12px 0}
.small-note{font-size:.9rem; color:var(--muted)}
hr.sep{border:0; border-top:1px solid #1f1f1f; margin:16px 0}

/* Totals */
.total-row{display:flex; justify-content:space-between; align-items:center; padding:12px 14px; border:1px solid #1f1f1f; border-radius:12px; margin:10px 0; background:#0f1015}
.total-row strong{font-size:1.05rem}
.balance{color:var(--gold); font-weight:800; font-size:1.25rem}

/* Discount highlight */
.flash{
  animation: flashGreen 900ms ease-in-out 1;
}
@keyframes flashGreen{
  0%{ box-shadow:0 0 0 0 rgba(41, 204, 137, .0); }
  30%{ box-shadow:0 0 0 10px rgba(41, 204, 137, .2); }
  100%{ box-shadow:0 0 0 0 rgba(41, 204, 137, .0); }
}

/* Signature */
.sigbox{border:1px dashed rgba(212,175,55,.55); border-radius:12px; padding:12px}
canvas#sig{width:100%; height:220px; background:#0f1015; border-radius:8px; touch-action:none; display:block}
.sig-actions{display:flex; gap:10px; margin-top:10px}

/* Floating footer */
footer{
  position:sticky; bottom:-76px; z-index:5; transition:transform .45s ease, opacity .45s ease; opacity:.98;
}
footer.scrolled{ transform:translateY(-76px); }
.foot{
  background:linear-gradient(0deg,rgba(212,175,55,.18),rgba(0,0,0,.35));
  border:1px solid rgba(212,175,55,.25); border-radius:20px; margin:8px auto 12px;
  max-width:1100px; padding:14px; display:flex; gap:12px; justify-content:flex-end; align-items:center; box-shadow:var(--shadow)
}

/* Hide logo box if image missing */
.logo-hidden{display:none}
</style>
</head>

<body>
<header>
  <div class="head">
    <div class="brand">
      <img id="brandLogo" alt="Logo" />
      <h1>WARM UP UK HOMES</h1>
    </div>
    <div class="actions">
      <button class="btn" id="btnPrintTop">Print / Save PDF</button>
      <button class="btn ghost" id="btnShareTop">Share via WhatsApp</button>
    </div>
  </div>
</header>

<div class="wrap">

  <!-- Hero / Office details -->
  <div class="card">
    <div class="row">
      <div>
        <label>Contract Number</label>
        <input id="contractNo" placeholder="WUUK-YYYYMMDD-XXXX" />
      </div>
      <div>
        <label>Date</label>
        <input id="date" type="date" />
      </div>
    </div>
    <hr class="sep">
    <div class="small-note">
      <strong>Office</strong> · Fitzwilliam House, Middle Bank, Doncaster, England, DN4 5NG —
      <strong>Tel</strong> <a href="tel:07470474774">07470 474 774</a> ·
      <strong>Email</strong> <a href="mailto:warmupuk@icloud.com">warmupuk@icloud.com</a>
    </div>
  </div>

  <!-- Client block -->
  <div class="card">
    <h2>Client & Job Details</h2>
    <div class="row">
      <div><label>Client name</label><input id="client" placeholder="Full name"></div>
      <div><label>Contact number (WhatsApp)</label><input id="phone" placeholder="+44... or 07..."></div>
      <div><label>Property address</label><input id="address" placeholder="Address, Postcode"></div>
      <div><label>Rep</label><input id="rep" placeholder="Rep name"></div>
      <div>
        <label>Job type</label>
        <select id="job">
          <option>Loft Insulation</option>
          <option>Cavity Wall Insulation</option>
          <option>Underfloor Insulation</option>
          <option>Room-in-Roof Insulation</option>
          <option>Other</option>
        </select>
      </div>
      <div><label>Date of install</label><input id="install" type="date"></div>
    </div>
  </div>

  <!-- Products & pricing -->
  <div class="card">
    <h2>Products & Pricing</h2>

    <div class="table">
      <div class="grid">
        <div class="th">Description</div>
        <div class="th">Qty</div>
        <div class="th">Unit £</div>
        <div class="th">Line £</div>

        <!-- First line -->
        <div class="line">
          <input class="desc" placeholder="e.g., Loft insulation — sqm">
        </div>
        <div class="line"><input class="qty" type="number" inputmode="decimal" value="1" min="0"></div>
        <div class="line"><input class="unit" type="number" inputmode="decimal" value="0" min="0" step="0.01"></div>
        <div class="line"><input class="lineTotal" type="number" inputmode="decimal" value="0.00" step="0.01" readonly></div>
      </div>

      <div class="addline">
        <button class="btn ghost" id="addLine">+ Add line</button>
      </div>

      <label class="small-note" style="display:flex;align-items:center;gap:10px;margin-top:6px">
        <input type="checkbox" id="vat" checked>
        <span>Apply VAT (20%)</span>
      </label>

      <hr class="sep">

      <div class="total-row"><span>Subtotal</span><strong id="subtotal">£0.00</strong></div>

      <div class="row">
        <div>
          <label>Discount before VAT (£)</label>
          <input id="discPre" type="number" inputmode="decimal" min="0" step="0.01" value="0">
        </div>
        <div>
          <label>Discount after VAT (Final) £</label>
          <input id="discPost" type="number" inputmode="decimal" min="0" step="0.01" value="0">
        </div>
      </div>
      <div style="margin-top:10px">
        <button class="btn" id="btnApplyDiscount">Apply Discount</button>
      </div>

      <div class="total-row"><span>VAT (20%)</span><strong id="vatAmt">£0.00</strong></div>
      <div class="total-row"><span>Total</span><strong id="total">£0.00</strong></div>

      <div class="row">
        <div>
          <label>Deposit £</label>
          <input id="deposit" type="number" inputmode="decimal" min="0" step="0.01" value="0">
        </div>
      </div>

      <div class="total-row">
        <span>Balance Due</span>
        <strong class="balance" id="balance">£0.00</strong>
      </div>
    </div>
  </div>

  <!-- Notes -->
  <div class="card">
    <h2>Notes / Instructions</h2>
    <textarea id="notes" placeholder="Write any installation notes or client instructions here..."></textarea>
  </div>

  <!-- Signature -->
  <div class="card">
    <h2>Signature</h2>
    <div class="sigbox">
      <canvas id="sig"></canvas>
      <div class="sig-actions">
        <button class="btn ghost" id="btnClearSig">Clear</button>
      </div>
    </div>
  </div>

</div>

<footer>
  <div class="foot">
    <button class="btn" id="btnPrintBottom">Print / Save PDF</button>
    <button class="btn ghost" id="btnShareBottom">Share via WhatsApp</button>
  </div>
</footer>

<script>
/* ---------- Header & footer slide ---------- */
const header = document.querySelector('header');
const footer = document.querySelector('footer');
let lastY = window.scrollY;
addEventListener('scroll', () => {
  const y = window.scrollY;
  if (y > 40) header.classList.add('scrolled'); else header.classList.remove('scrolled');
  if (y > lastY) footer.classList.add('scrolled'); else footer.classList.remove('scrolled');
  lastY = y;
});

/* ---------- Logo with fallback (png -> JPG -> hide) ---------- */
(function loadLogo(){
  const el = document.getElementById('brandLogo');
  function hide(){ el.classList.add('logo-hidden'); }
  function tryJpg(){ el.onerror = hide; el.src = 'assets/WUUK.JPG'; }
  el.onerror = tryJpg; el.src = 'assets/wuuk-logo.png';
})();

/* ---------- Contract number + today ---------- */
(function initDates(){
  const d = new Date();
  const yyyy = d.getFullYear();
  const mm = String(d.getMonth()+1).padStart(2,'0');
  const dd = String(d.getDate()).padStart(2,'0');
  const rand = Math.floor(1000 + Math.random()*9000);
  document.getElementById('contractNo').value = `WUUK-${yyyy}${mm}${dd}-${rand}`;
  document.getElementById('date').value = `${yyyy}-${mm}-${dd}`;
})();

/* ---------- Products table logic ---------- */
const grid = document.querySelector('.grid');
const addLineBtn = document.getElementById('addLine');

function formatGBP(n){ return `£${(Number(n)||0).toFixed(2)}`; }

function recalc(){
  // Recompute each line total
  const rows = grid.querySelectorAll('.lineTotal');
  rows.forEach((lt,i)=>{
    const qty = Number(grid.querySelectorAll('.qty')[i].value)||0;
    const unit = Number(grid.querySelectorAll('.unit')[i].value)||0;
    lt.value = (qty*unit).toFixed(2);
  });
  // Subtotal
  const lines = [...grid.querySelectorAll('.lineTotal')].map(i=>Number(i.value)||0);
  let subtotal = lines.reduce((a,b)=>a+b,0);
  const discPre = Number(document.getElementById('discPre').value)||0;
  const vatChecked = document.getElementById('vat').checked;
  const vatAmt = Math.max(0, (subtotal - discPre)) * (vatChecked ? 0.20 : 0);
  let total = Math.max(0, subtotal - discPre) + vatAmt;
  const discPost = Number(document.getElementById('discPost').value)||0;
  total = Math.max(0, total - discPost);
  const deposit = Number(document.getElementById('deposit').value)||0;
  const balance = Math.max(0, total - deposit);

  document.getElementById('subtotal').textContent = formatGBP(subtotal);
  document.getElementById('vatAmt').textContent = formatGBP(vatAmt);
  document.getElementById('total').textContent = formatGBP(total);
  const balEl = document.getElementById('balance');
  balEl.textContent = formatGBP(balance);
}

function addLine(){
  const frag = document.createDocumentFragment();
  // description
  const d1 = document.createElement('div'); d1.className='line';
  const i1 = document.createElement('input'); i1.className='desc'; i1.placeholder='Description';
  d1.appendChild(i1);
  // qty
  const d2 = document.createElement('div'); d2.className='line';
  const i2 = document.createElement('input'); i2.className='qty'; i2.type='number'; i2.inputMode='decimal'; i2.value='1'; i2.min='0';
  d2.appendChild(i2);
  // unit
  const d3 = document.createElement('div'); d3.className='line';
  const i3 = document.createElement('input'); i3.className='unit'; i3.type='number'; i3.inputMode='decimal'; i3.value='0'; i3.min='0'; i3.step='0.01';
  d3.appendChild(i3);
  // line total
  const d4 = document.createElement('div'); d4.className='line';
  const i4 = document.createElement('input'); i4.className='lineTotal'; i4.type='number'; i4.inputMode='decimal'; i4.value='0.00'; i4.step='0.01'; i4.readOnly = true;
  d4.appendChild(i4);

  [i1,i2,i3].forEach(el=>el.addEventListener('input', recalc));
  [d1,d2,d3,d4].forEach(el=>frag.appendChild(el));
  grid.appendChild(frag);
  recalc();
}

[...document.querySelectorAll('.qty,.unit')].forEach(el=>el.addEventListener('input', recalc));
document.getElementById('discPre').addEventListener('input', recalc);
document.getElementById('discPost').addEventListener('input', recalc);
document.getElementById('deposit').addEventListener('input', recalc);
document.getElementById('vat').addEventListener('change', recalc);
addLineBtn.addEventListener('click', addLine);
recalc();

/* Discount flash */
document.getElementById('btnApplyDiscount').addEventListener('click', (e)=>{
  recalc();
  const balBox = document.getElementById('balance').parentElement;
  balBox.classList.remove('flash');
  void balBox.offsetWidth; // reflow to restart animation
  balBox.classList.add('flash');
});

/* ---------- Signature pad (no drifting) ---------- */
(function signature(){
  const canvas = document.getElementById('sig');
  const ctx = canvas.getContext('2d');
  function fit(){ const r = canvas.getBoundingClientRect(); canvas.width = r.width*2; canvas.height = r.height*2; ctx.scale(2,2); ctx.lineWidth=2; ctx.lineCap='round'; ctx.strokeStyle='#ffd766'; }
  fit(); addEventListener('resize', fit);
  let drawing=false, last=null;
  function pos(e){
    if(e.touches){ const t=e.touches[0]; const r=canvas.getBoundingClientRect(); return {x:t.clientX-r.left, y:t.clientY-r.top}; }
    const r=canvas.getBoundingClientRect(); return {x:e.clientX-r.left, y:e.clientY-r.top};
  }
  function start(e){ drawing=true; last=pos(e); e.preventDefault(); }
  function move(e){ if(!drawing) return; const p=pos(e); ctx.beginPath(); ctx.moveTo(last.x,last.y); ctx.lineTo(p.x,p.y); ctx.stroke(); last=p; e.preventDefault(); }
  function end(){ drawing=false; }
  canvas.addEventListener('mousedown', start);
  canvas.addEventListener('mousemove', move);
  addEventListener('mouseup', end);
  canvas.addEventListener('touchstart', start, {passive:false});
  canvas.addEventListener('touchmove', move, {passive:false});
  addEventListener('touchend', end);
  document.getElementById('btnClearSig').addEventListener('click', ()=>{ ctx.clearRect(0,0,canvas.width,canvas.height); });
})();

/* ---------- Print & WhatsApp ---------- */
function printDoc(){ window.print(); }
function shareWhatsApp(){
  // Build a clean summary
  const lines = [...document.querySelectorAll('.grid .lineTotal')].map((lt,i)=>{
    const d = document.querySelectorAll('.desc')[i].value || 'Item';
    const q = document.querySelectorAll('.qty')[i].value || '0';
    const u = document.querySelectorAll('.unit')[i].value || '0';
    const l = lt.value || '0';
    return `• ${d} — Qty ${q} @ £${(+u).toFixed(2)} = £${(+l).toFixed(2)}`;
  }).filter(Boolean).join('%0A');

  const msg = `WARM UP UK HOMES%0AContract: ${encodeURIComponent(document.getElementById('contractNo').value)}%0ADate: ${document.getElementById('date').value}%0A%0AClient: ${encodeURIComponent(document.getElementById('client').value)}%0AAddress: ${encodeURIComponent(document.getElementById('address').value)}%0A%0AItems:%0A${lines}%0A%0ASubtotal: ${encodeURIComponent(document.getElementById('subtotal').textContent)}%0AVAT: ${encodeURIComponent(document.getElementById('vatAmt').textContent)}%0ATotal: ${encodeURIComponent(document.getElementById('total').textContent)}%0ADeposit: £${(Number(document.getElementById('deposit').value)||0).toFixed(2)}%0ABalance: ${encodeURIComponent(document.getElementById('balance').textContent)}`;
  const url = `https://wa.me/?text=${msg}`;
  window.open(url, '_blank');
}
document.getElementById('btnPrintTop').onclick = printDoc;
document.getElementById('btnPrintBottom').onclick = printDoc;
document.getElementById('btnShareTop').onclick = shareWhatsApp;
document.getElementById('btnShareBottom').onclick = shareWhatsApp;
</script>
</body>
</html>
