<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Warm Up UK Homes — Contract Builder</title>
<style>
  :root{
    --bg:#0f0f0f; --panel:#161616; --ink:#eaeaea; --muted:#9a9a9a;
    --gold:#e2b63b; --gold-d:#b89221; --orange:#ff8c1a; --neon:#00ff6a;
  }
  html,body{margin:0;background:#000;color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
  .wrap{max-width:900px;margin:16px auto;padding:0 12px}
  .card{background:linear-gradient(160deg,#1b1b1b 0%, #111 100%);border-radius:18px;border:1px solid #272727;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  .hero{padding:18px 16px 20px;position:relative;overflow:hidden}
  /* animated banner glow */
  .hero::after{
    content:"";position:absolute;inset:-40% -10% auto;height:160%;
    background:radial-gradient(100% 60% at 50% 0%, rgba(226,182,59,.25), transparent 60%);
    animation:float 6s ease-in-out infinite alternate;
    pointer-events:none
  }
  @keyframes float{to{transform:translate3d(0,14px,0) scale(1.02)}}

  .brand{display:flex;gap:12px;align-items:center;position:relative;z-index:2}
  .logo{width:46px;height:46px;border-radius:12px;background:#000 url('assets/warmupuk-logo.png') center/contain no-repeat;border:1px solid #2c2c2c}
  .title h1{margin:0;font-size:28px;letter-spacing:.02em}
  .subtitle{margin:4px 0 0;color:var(--muted);font-size:14px}
  .actions{display:flex;gap:12px;margin-top:14px;flex-wrap:wrap}
  .btn{appearance:none;border:0;cursor:pointer;border-radius:16px;padding:12px 16px;font-weight:650}
  .btn-gold{background:var(--gold);color:#1b1400;border:1px solid var(--gold-d)}
  .btn-dark{background:#0e0e0e;color:#eee;border:1px solid #2a2a2a}
  .btn:active{transform:translateY(1px)}

  .section{margin-top:14px}
  .panel{background:var(--panel);border:1px dashed #2a2a2a;border-radius:18px;padding:16px 14px}
  .section h2{margin:0 0 10px;color:var(--gold);letter-spacing:.04em}

  label{display:block;margin:12px 0 6px;color:#d7d7d7;font-weight:600}
  input,select,textarea{width:100%;background:#0b0b0b;color:var(--ink);
    border:2px solid var(--orange); /* orange outline for all boxes */
    border-radius:12px;padding:14px;font-size:16px;outline:none}
  textarea{min-height:90px;resize:vertical}

  /* products table */
  .grid{display:grid;grid-template-columns:1.2fr .8fr .8fr .8fr auto;gap:10px;align-items:center}
  .grid > div{min-height:1px}
  .small{font-size:12px;color:var(--muted)}
  .line-total, .money{font-variant-numeric:tabular-nums}

  .row{display:grid;grid-template-columns:1.2fr .8fr .8fr .8fr auto;gap:10px;margin:8px 0}
  .x{background:#131313;border:1px solid #2a2a2a;border-radius:10px;color:#bbb;padding:0 10px;height:46px;display:flex;align-items:center}
  .x button{all:unset;cursor:pointer;color:#bbb}
  .addline{margin-top:6px}

  /* toggles */
  .toggle{display:inline-flex;align-items:center;gap:10px}
  .switch{position:relative;width:56px;height:32px;background:#222;border-radius:999px;border:1px solid #393939;cursor:pointer;transition:.2s}
  .switch::after{content:"";position:absolute;top:3px;left:3px;width:26px;height:26px;background:#fff;border-radius:50%;transition:.2s}
  .switch.on{background:#103a22;box-shadow:0 0 14px rgba(0,255,106,.35) inset, 0 0 20px rgba(0,255,106,.3)}
  .switch.on::after{left:27px;background:var(--neon)}
  .neon-flash{animation:flash 1s ease-in-out 2}
  @keyframes flash{0%,100%{box-shadow:0 0 0 0 rgba(0,255,106,.0)}50%{box-shadow:0 0 16px 6px rgba(0,255,106,.75)}}

  .totals{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
  .total-box{background:#0b0b0b;border:2px solid #3a3a3a;border-radius:14px;padding:14px}
  .total-box.big{border-color:var(--gold);font-size:22px;font-weight:800}
  .right{text-align:right}

  /* signature */
  .sig-wrap{margin-top:8px}
  #sig{width:100%;height:180px;background:#000;border:2px dashed var(--orange);border-radius:14px;touch-action:none}
  .sig-actions{display:flex;gap:10px;margin-top:8px}

  .fine{color:var(--muted);font-size:12px;margin-top:10px}
</style>
</head>
<body>
  <div class="wrap">
    <!-- HEADER -->
    <div class="card hero">
      <div class="brand">
        <div class="logo" aria-label="Warm Up UK Homes logo"></div>
        <div class="title">
          <h1>WARM UP UK HOMES</h1>
          <div class="subtitle">Contract Builder</div>
        </div>
      </div>
      <div class="actions">
        <button class="btn btn-gold" id="btnSavePdf">Save PDF</button>
        <button class="btn btn-dark" id="btnWhatsApp">WhatsApp</button>
        <button class="btn btn-dark" id="btnSavePhone">Save quote to phone</button>
      </div>
    </div>

    <!-- CLIENT -->
    <div class="section">
      <div class="panel">
        <h2>CLIENT &amp; JOB DETAILS</h2>
        <label>Contract Number</label>
        <input id="contractNo" placeholder="WUUK-YYYYMMDD-XXXX" readonly>

        <label>Date</label>
        <input id="dateField" type="date">

        <label>Client name</label>
        <input id="client">

        <label>Contact number (WhatsApp)</label>
        <input id="phone" inputmode="tel" placeholder="+44… or 07…">

        <label>Property address</label>
        <textarea id="address" placeholder="Address, Postcode"></textarea>
      </div>
    </div>

    <!-- PRODUCTS -->
    <div class="section">
      <div class="panel">
        <h2>PRODUCTS &amp; PRICING</h2>

        <div class="grid small">
          <div>Product</div><div>Size (m)</div><div>Unit £/m</div><div>Line £</div><div></div>
        </div>
        <div id="lines"></div>
        <button class="btn btn-dark addline" id="addLine">+ Add line</button>

        <div style="margin-top:14px;display:flex;gap:16px;align-items:center;flex-wrap:wrap">
          <div class="toggle">
            <div>VAT (20%)</div>
            <div id="vatSwitch" class="switch on" role="switch" aria-checked="true"></div>
          </div>

          <div class="toggle">
            <div>Enable Discount</div>
            <div id="discSwitch" class="switch" role="switch" aria-checked="false"></div>
          </div>

          <div class="right" style="margin-left:auto">
            <strong>Before / After</strong>
          </div>
        </div>

        <div id="discountFields" style="display:none;margin-top:8px">
          <label>Discount Before (£)</label>
          <input id="discBefore" type="number" min="0" step="0.01" value="0">

          <label>Discount After (£)</label>
          <input id="discAfter" type="number" min="0" step="0.01" value="0">
        </div>

        <div class="totals">
          <div class="total-box">
            <div>Subtotal</div>
            <div class="right money" id="subtotal">£0.00</div>
          </div>
          <div class="total-box">
            <div>VAT</div>
            <div class="right money" id="vat">£0.00</div>
          </div>
          <div class="total-box">
            <label>Deposit (paid / due now)</label>
            <input id="deposit" type="number" min="0" step="0.01" value="0">
          </div>
          <div class="total-box big" id="finalBox">
            <div>Final to Pay Today</div>
            <div class="right money" id="final">£0.00</div>
          </div>
        </div>
      </div>
    </div>

    <!-- SIGNATURE -->
    <div class="section">
      <div class="panel">
        <h2>Signature</h2>
        <div class="sig-wrap">
          <canvas id="sig"></canvas>
          <div class="sig-actions">
            <button class="btn btn-dark" id="clearSig">Clear</button>
          </div>
          <div class="fine">Sign inside the black box with your finger (orange ink).</div>
        </div>
      </div>
    </div>

    <p class="fine wrap" style="opacity:.7">Totals update automatically. “Save quote to phone” stores everything safely on this device only.</p>
  </div>

<script>
(function(){
  const £ = s=>document.querySelector(s);
  const ££ = s=>document.querySelectorAll(s);
  const fmt = n => "£" + (isNaN(n)?0:n).toFixed(2);

  // --- Contract number + date
  function genContract(){
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,'0');
    const day = String(d.getDate()).padStart(2,'0');
    const rand = Math.floor(1000+Math.random()*9000);
    return `WUUK-${y}${m}${day}-${rand}`;
  }
  $('#contractNo').value = genContract();
  $('#dateField').valueAsDate = new Date();

  // --- Lines (product rows)
  const catalog = [
    {label:'Spray foam removal', unit:25},
    {label:'Ceiling level insulation', unit:18},
    {label:'Multifoil insulation', unit:22},
  ];
  const lines = $('#lines');

  function makeRow(data={}){
    const row = document.createElement('div');
    row.className='row';
    row.innerHTML = `
      <select class="prod">
        ${catalog.map(c=>`<option ${c.label===data.prod?'selected':''}>${c.label}</option>`).join('')}
      </select>
      <input class="size" type="number" min="0" step="0.01" value="${data.size??0}">
      <input class="unit" type="number" min="0" step="0.01" value="${data.unit ?? catalog[0].unit}">
      <div class="x money line">£0.00</div>
      <div class="x"><button class="remove" aria-label="Remove">✕</button></div>
    `;
    row.addEventListener('input', recalc);
    row.querySelector('.remove').onclick = ()=>{ row.remove(); recalc(); }
    row.querySelector('.prod').addEventListener('change', (e)=>{
      const found = catalog.find(c=>c.label===e.target.value);
      row.querySelector('.unit').value = found ? found.unit : 0;
      recalc();
    });
    lines.appendChild(row);
  }

  $('#addLine').onclick = ()=> makeRow();
  // start with one row
  makeRow();

  // --- Switches
  const vatSwitch = $('#vatSwitch');
  const discSwitch = $('#discSwitch');
  vatSwitch.onclick = ()=>{ vatSwitch.classList.toggle('on'); recalc(); }
  discSwitch.onclick = ()=>{
    discSwitch.classList.toggle('on');
    const on = discSwitch.classList.contains('on');
    $('#discountFields').style.display = on ? '' : 'none';
    // neon flash when enabling discount
    if(on){ $('#finalBox').classList.add('neon-flash'); setTimeout(()=>$('#finalBox').classList.remove('neon-flash'), 1200); }
    recalc();
  }

  $('#discBefore,#discAfter,#deposit').addEventListener('input', recalc);
  lines.addEventListener('input', recalc);

  function recalc(){
    let subtotal = 0;
    ££('.row').forEach(r=>{
      const size = parseFloat(r.querySelector('.size').value)||0;
      const unit = parseFloat(r.querySelector('.unit').value)||0;
      const line = size*unit;
      r.querySelector('.line').textContent = fmt(line);
      subtotal += line;
    });
    const vatOn = vatSwitch.classList.contains('on');
    const vat = vatOn ? subtotal*0.20 : 0;

    // discount (before/after)
    let disc = 0;
    if(discSwitch.classList.contains('on')){
      const b = parseFloat($('#discBefore').value)||0;
      const a = parseFloat($('#discAfter').value)||0;
      disc = Math.max(0, b-a); // amount to subtract
    }
    const deposit = parseFloat($('#deposit').value)||0;

    const final = Math.max(0, subtotal + vat - disc - deposit);

    $('#subtotal').textContent = fmt(subtotal);
    $('#vat').textContent = fmt(vat);
    $('#final').textContent = fmt(final);
  }
  recalc();

  // --- Signature pad (black bg, orange ink)
  const canvas = $('#sig');
  const ctx = canvas.getContext('2d', { willReadFrequently:true });
  function fitCanvas(){
    const r = canvas.getBoundingClientRect();
    canvas.width = Math.floor(r.width*2);
    canvas.height = Math.floor(r.height*2);
    ctx.scale(2,2);
    ctx.fillStyle = '#000'; ctx.fillRect(0,0,r.width,r.height);
    ctx.lineCap='round'; ctx.lineJoin='round'; ctx.strokeStyle= '#ff8c1a'; ctx.lineWidth=3.2;
  }
  window.addEventListener('resize', fitCanvas, {passive:true});
  fitCanvas();

  let drawing=false, lx=0, ly=0;
  function p(e){ const t = e.touches? e.touches[0]: e; const b = canvas.getBoundingClientRect();
    return {x: t.clientX - b.left, y: t.clientY - b.top};}
  function down(e){ drawing=true; const {x,y}=p(e); lx=x; ly=y; e.preventDefault(); }
  function move(e){ if(!drawing) return; const {x,y}=p(e); ctx.beginPath(); ctx.moveTo(lx,ly); ctx.lineTo(x,y); ctx.stroke(); lx=x; ly=y; e.preventDefault(); }
  function up(){ drawing=false; }

  canvas.addEventListener('mousedown',down);canvas.addEventListener('mousemove',move);
  window.addEventListener('mouseup',up);
  canvas.addEventListener('touchstart',down,{passive:false});
  canvas.addEventListener('touchmove',move,{passive:false});
  window.addEventListener('touchend',up);

  $('#clearSig').onclick = fitCanvas;

  // --- Save PDF (rely on mobile “Print to PDF”)
  $('#btnSavePdf').onclick = ()=>window.print();

  // --- WhatsApp share
  $('#btnWhatsApp').onclick = ()=>{
    const text = [
      'WARM UP UK HOMES',
      `Contract: ${$('#contractNo').value}`,
      `Client: ${$('#client').value||'-'}`,
      `Address: ${($('#address').value||'-').replace(/\n/g, ', ')}`,
      `Subtotal: ${$('#subtotal').textContent}`,
      `VAT: ${$('#vat').textContent}`,
      `Deposit: £${(parseFloat($('#deposit').value)||0).toFixed(2)}`,
      `Final Today: ${$('#final').textContent}`
    ].join('\n');
    const url = 'https://wa.me/?text=' + encodeURIComponent(text);
    window.open(url,'_blank');
  }

  // --- Save to phone (localStorage)
  const key = 'wuuk-contract';
  $('#btnSavePhone').onclick = ()=>{
    const payload = {
      contractNo: $('#contractNo').value,
      date: $('#dateField').value,
      client: $('#client').value,
      phone: $('#phone').value,
      address: $('#address').value,
      vat: vatSwitch.classList.contains('on'),
      discountOn: discSwitch.classList.contains('on'),
      discBefore: $('#discBefore').value, discAfter: $('#discAfter').value,
      deposit: $('#deposit').value,
      lines: [...££('.row')].map(r=>({
        prod: r.querySelector('.prod').value,
        size: r.querySelector('.size').value,
        unit: r.querySelector('.unit').value
      })),
      total: $('#final').textContent
    };
    localStorage.setItem(key, JSON.stringify(payload));
    alert('Saved to this phone.');
  };

  // Auto-load any saved draft
  try{
    const saved = JSON.parse(localStorage.getItem(key)||'null');
    if(saved){
      $('#contractNo').value = saved.contractNo || genContract();
      if(saved.date) $('#dateField').value = saved.date;
      $('#client').value = saved.client||'';
      $('#phone').value = saved.phone||'';
      $('#address').value = saved.address||'';
      vatSwitch.classList.toggle('on', !!saved.vat);
      discSwitch.classList.toggle('on', !!saved.discountOn);
      $('#discountFields').style.display = discSwitch.classList.contains('on') ? '' : 'none';
      $('#discBefore').value = saved.discBefore||0;
      $('#discAfter').value = saved.discAfter||0;
      $('#deposit').value = saved.deposit||0;
      lines.innerHTML='';
      (saved.lines||[]).forEach(makeRow);
      if((saved.lines||[]).length===0) makeRow();
      recalc();
    }
  }catch(e){ /* ignore */ }

})();
</script>
</body>
</html>
