<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Warm Up UK Calendar</title>
<style>
  body { font-family: Arial, sans-serif; background:#111; color:#f5f5f5; margin:0; padding:20px;}
  .container { max-width: 600px; margin:auto; background:#1e1e1e; padding:20px; border-radius:10px;}
  label {display:block; margin:8px 0 4px;}
  input, textarea, select {width:100%; padding:8px; border-radius:6px; border:none; margin-bottom:10px;}
  button {padding:12px; width:100%; border:none; border-radius:6px; background:#d4af37; color:#111; font-weight:bold; cursor:pointer;}
</style>
</head>
<body>
<div class="container">
  <h1>ðŸ“… Calendar Booking</h1>

  <label>Name</label>
  <input id="name" type="text">

  <label>Phone (WhatsApp)</label>
  <input id="phone" type="text" placeholder="+447...">

  <label>Address</label>
  <textarea id="address"></textarea>

  <label>Date</label>
  <input id="date" type="date">

  <label>Time</label>
  <input id="time" type="time">

  <label>Service</label>
  <select id="service">
    <option>Loft Insulation</option>
    <option>Spray Foam Removal</option>
    <option>Boiler Service</option>
    <option>Multifoil Installation</option>
  </select>

  <label>Price (Â£)</label>
  <input id="price" type="number">

  <label>Notes</label>
  <textarea id="notes"></textarea>

  <button onclick="sendWhatsApp()">Send to WhatsApp</button>
</div>

<script>
function sendWhatsApp(){
  const name = document.getElementById('name').value.trim();
  const phoneRaw = document.getElementById('phone').value.trim();
  const phone = phoneRaw.replace(/\D/g,''); // WhatsApp needs digits only
  const address = document.getElementById('address').value.trim();
  const date = document.getElementById('date').value;
  const time = document.getElementById('time').value;
  const service = document.getElementById('service').value;
  const price = document.getElementById('price').value;
  const notes = document.getElementById('notes').value;

  if(!phone || !name){ alert("Enter at least name and WhatsApp number"); return; }

  // Contract link with query params
  const contractUrl = `https://warmupuk.github.io/contract.html?name=${encodeURIComponent(name)}&phone=${encodeURIComponent(phone)}&address=${encodeURIComponent(address)}&date=${encodeURIComponent(date+' '+time)}&product=${encodeURIComponent(service)}&price=${encodeURIComponent(price)}&notes=${encodeURIComponent(notes)}`;

  const msg = `Hello ${name}, here is your Warm Up UK contract:\n${contractUrl}`;

  const waLink = `https://wa.me/${phone}?text=${encodeURIComponent(msg)}`;
  window.location.href = waLink;
}
</script>
</body>
</html>

<!-- WhatsApp Send Button -->
<div style="text-align:center; margin:24px 0 40px;">
  <button id="btn_send_whatsapp"
          style="background:linear-gradient(180deg,#ffc94d,#d7ac3a); color:#121212; 
                 font-weight:800; border:0; border-radius:12px; padding:12px 18px;
                 box-shadow:0 10px 22px rgba(255,201,77,.25); cursor:pointer;">
    Send Contract via WhatsApp
  </button>
</div>

<script>
  document.getElementById('btn_send_whatsapp').addEventListener('click', () => {
    const name   = document.getElementById('c_name')?.value || 'Client';
    const phone  = document.getElementById('c_phone1')?.value || '';
    const notes  = document.getElementById('notes')?.value  || '';
    const total  = document.getElementById('q_total')?.textContent || '';
    const svcRow = document.querySelector('#prod_table tbody tr:first-child .p_sel');
    const service = svcRow ? svcRow.options[svcRow.selectedIndex].text : (new URLSearchParams(location.search).get('service') || 'Service');

    const intl = formatUK(phone);
    if (!intl) { alert('No valid phone number found. Please enter the client phone in the form.'); return; }

    const msg = [
      `Warm Up UK â€“ Contract`,
      `Name: ${name}`,
      `Service: ${service}`,
      total ? `Total: ${total}` : null,
      notes ? `Notes: ${notes}` : null,
      `Thank you!`
    ].filter(Boolean).join('\n');

    const url = `https://wa.me/${intl}?text=${encodeURIComponent(msg)}`;
    window.open(url, '_blank');
  });
</script>
