<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Warm Up UK Homes — Contract Builder</title>
<style>
  :root{
    --bg:#0f0f0f; --panel:#141414; --text:#f2f2f2; --muted:#a5a5a5;
    --gold:#d4af37; --orange:#ff8c1a; --neon:#39ff14;
    --edge:#232323;
  }
  html,body{margin:0;background:var(--bg);color:var(--text);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
  .wrap{max-width:860px;margin:24px auto;padding:12px}
  .banner{background:
      radial-gradient(120% 80% at 10% -10%, #3a3019 0, #1b160a 45%, #17140a 60%, #121212 100%);
    border:1px solid #2a2410;border-radius:16px;padding:20px 18px 16px;position:sticky;top:0;z-index:5}
  .brand{display:flex;gap:14px;align-items:center}
  .logo{
    width:44px;height:44px;border-radius:10px;background:#000 url('assets/warmupuk-logo.png.PNG') center/cover no-repeat;
    box-shadow:0 0 0 2px #1a1a1a, 0 0 18px rgba(212,175,55,.25);
    animation:pulse 2.6s ease-in-out infinite;
  }
  @keyframes pulse {0%,100%{box-shadow:0 0 0 2px #1a1a1a,0 0 14px rgba(212,175,55,.15)}50%{box-shadow:0 0 0 2px #1a1a1a,0 0 28px rgba(212,175,55,.45)}}
  h1{margin:0;font-size:28px;letter-spacing:.04em}
  .bar{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  .btn{appearance:none;border:0;border-radius:14px;padding:12px 16px;font-weight:700}
  .btn-gold{background:var(--gold);color:#211a07}
  .btn-dark{background:#1b1b1b;color:#d9d9d9;border:1px solid #2a2a2a}
  /* cards */
  .card{background:var(--panel);border:1px solid var(--edge);border-radius:16px;margin-top:18px;padding:16px}
  .card h2{margin:0 0 12px 0;color:var(--gold);letter-spacing:.06em}
  /* inputs */
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .row-1{grid-template-columns:1fr}
  label{font-size:.92rem;color:var(--muted)}
  input,select,textarea{
    width:100%;background:#111;border:2px solid var(--orange);color:var(--text);
    border-radius:12px;padding:12px 12px;font-size:1rem;outline:none;
  }
  textarea{min-height:90px;resize:vertical}
  input[readonly]{opacity:.9}
  /* products table */
  .products thead th{font-weight:700;color:#cfcfcf;text-align:left;border-bottom:1px dashed #2a2a2a;padding:8px 6px}
  .products td{padding:8px 6px;vertical-align:middle}
  .products .line{font-weight:800}
  .addline{margin-top:10px}
  /* little toggles */
  .toggle{display:flex;align-items:center;gap:12px}
  .switch{position:relative;width:52px;height:28px}
  .switch input{opacity:0;width:0;height:0}
  .knob{position:absolute;inset:0;border:2px solid var(--edge);background:#101010;border-radius:999px;transition:.2s}
  .knob::after{content:"";position:absolute;left:4px;top:4px;width:18px;height:18px;border-radius:50%;background:#666;transition:.2s}
  .switch input:checked+.knob{border-color:#1f321f;background:#0e1a0e;box-shadow:0 0 18px rgba(57,255,20,.35)}
  .switch input:checked+.knob::after{left:28px;background:var(--neon)}
  /* neon flash when discount box is active */
  .discount-live{animation:flash 1.1s ease-in-out infinite}
  @keyframes flash{0%,100%{box-shadow:0 0 0 0 rgba(57,255,20,.0),0 0 12px rgba(57,255,20,.25)}50%{box-shadow:0 0 0 2px rgba(57,255,20,.45),0 0 24px rgba(57,255,20,.55)}}
  /* signature */
  .sig-wrap{background:#000;border:2px dashed var(--orange);border-radius:12px;overflow:hidden}
  canvas{touch-action:none;display:block;width:100%;height:240px;background:#000}
  .sig-actions{display:flex;gap:10px;margin-top:8px}
  .btn-mini{padding:8px 12px;border-radius:10px;border:1px solid #2a2a2a;background:#181818;color:#dcdcdc}
  .totals{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center;margin-top:12px}
  .grand{font-size:1.25rem;font-weight:800}
  .muted{color:var(--muted)}
  @media (max-width:720px){
    .row{grid-template-columns:1fr}
  }
</style>
</head>
<body>
  <div class="wrap">
    <!-- Banner -->
    <div class="banner">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>WARM UP UK HOMES</h1>
          <small style="color:#9d8b3a">Contract Builder</small>
        </div>
      </div>
      <div class="bar">
        <button class="btn btn-gold" id="btnSavePdf">Save PDF</button>
        <button class="btn btn-dark" id="btnWhatsApp">WhatsApp</button>
        <button class="btn btn-dark" id="btnSaveQuote">Save quote to phone</button>
      </div>
    </div>

    <!-- Client details -->
    <div class="card">
      <h2>CLIENT &amp; JOB DETAILS</h2>
      <div class="row">
        <div><label>Contract Number</label><input id="contractNo" readonly></div>
        <div><label>Date</label><input id="date" readonly></div>
      </div>
      <div class="row">
        <div><label>Client name</label><input id="client"></div>
        <div><label>Contact number (WhatsApp)</label><input id="phone"></div>
      </div>
      <div class="row row-1">
        <div><label>Property address</label><input id="address"></div>
      </div>
    </div>

    <!-- Products -->
    <div class="card">
      <h2>PRODUCTS &amp; PRICING</h2>

      <table class="products" style="width:100%">
        <thead>
          <tr>
            <th style="width:44%">Product</th>
            <th style="width:18%">Size (m)</th>
            <th style="width:18%">Unit £/m</th>
            <th style="width:20%">Line £</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="lines">
          <!-- rows injected -->
        </tbody>
      </table>

      <button class="btn btn-dark addline" id="addLine">+ Add line</button>

      <div class="totals"><span class="muted">Subtotal</span><span id="subtotal">£0.00</span></div>

      <div class="totals">
        <span class="toggle">
          <label style="color:#cfcfcf">VAT (20%)</label>
          <label class="switch">
            <input type="checkbox" id="vatOn" checked>
            <span class="knob"></span>
          </label>
        </span>
        <span id="vat">£0.00</span>
      </div>

      <div class="totals">
        <span class="toggle">
          <label style="color:#cfcfcf">Enable Discount</label>
          <label class="switch">
            <input type="checkbox" id="discOn">
            <span class="knob"></span>
          </label>
        </span>
        <span class="muted">Before / After</span>
      </div>

      <div class="row">
        <div><label>Discount Before (£)</label><input id="discBefore" readonly></div>
        <div><label>Discount After (£)</label><input id="discAfter"></div>
      </div>

      <div class="row">
        <div><label>Deposit (paid / due now)</label><input id="deposit" value="0"></div>
        <div class="grand"><label>Final to Pay Today</label><input id="finalToday" readonly></div>
      </div>

      <div class="totals grand"><span>Grand Total</span><span id="grand">£0.00</span></div>
    </div>

    <!-- Notes -->
    <div class="card">
      <h2>NOTES</h2>
      <textarea id="notes" placeholder="Installation notes / special instructions"></textarea>
    </div>

    <!-- Signature -->
    <div class="card">
      <h2>SIGNATURE</h2>
      <div class="sig-wrap">
        <canvas id="sig"></canvas>
      </div>
      <div class="sig-actions">
        <button class="btn-mini" id="sigClear">Clear</button>
      </div>
    </div>
  </div>

<script>
(() => {
  /* ---------- helpers ---------- */
  const £ = sel => document.querySelector(sel);
  const ££ = sel => [...document.querySelectorAll(sel)];
  const money = n => '£' + (isFinite(n) ? Number(n).toFixed(2) : '0.00');

  /* ---------- contract/date ---------- */
  function genContract(){
    const d=new Date(), pad=n=>String(n).padStart(2,'0');
    const y=d.getFullYear(), m=pad(d.getMonth()+1), day=pad(d.getDate());
    const rand=String(Math.floor(1000+Math.random()*9000));
    return `WUUK-${y}${m}${day}-${rand}`;
  }
  $('#contractNo').value = genContract();
  $('#date').value = new Date().toLocaleDateString('en-GB');

  /* ---------- products ---------- */
  const defaultProducts = [
    'Spray foam removal',
    'Ceiling level insulation',
    'Multifoil'
  ];

  const linesTbody = $('#lines');

  function rowTemplate(){
    const tr = document.createElement('tr'); tr.className='product-row';
    tr.innerHTML = `
      <td>
        <select class="prod">
          ${defaultProducts.map(x=>`<option>${x}</option>`).join('')}
        </select>
      </td>
      <td><input type="number" class="size" min="0" step="0.01" value="0"></td>
      <td><input type="number" class="unit" min="0" step="0.01" value="0"></td>
      <td class="line">£0.00</td>
      <td><button class="btn-mini del">x</button></td>
    `;
    return tr;
  }

  function addRow(){
    const r = rowTemplate();
    linesTbody.appendChild(r);
    bindRow(r);
    recalc();
    r.scrollIntoView({behavior:'smooth',block:'center'});
  }

  function bindRow(tr){
    const inputs = tr.querySelectorAll('input,select');
    inputs.forEach(el => el.addEventListener('input', recalc));
    tr.querySelector('.del').addEventListener('click', () => {
      tr.remove(); recalc();
    });
  }

  // start with one row
  addRow();
  $('#addLine').addEventListener('click', addRow);

  /* ---------- discount / vat / deposit ---------- */
  const discOn   = $('#discOn');
  const discBefore = $('#discBefore');
  const discAfter  = $('#discAfter');
  const vatOn    = $('#vatOn');
  const deposit  = $('#deposit');

  discOn.addEventListener('change', () => {
    discAfter.readOnly = !discOn.checked;
    discAfter.parentElement.querySelector('label').style.color = discOn.checked ? '#fff' : 'var(--muted)';
    discAfter.classList.toggle('discount-live', discOn.checked);
    recalc();
  });
  vatOn.addEventListener('change', recalc);
  deposit.addEventListener('input', recalc);
  discAfter.addEventListener('input', recalc);

  /* ---------- math ---------- */
  function recalc(){
    let subtotal = 0;
    ££('.product-row').forEach(tr=>{
      const size = parseFloat(tr.querySelector('.size').value)||0;
      const unit = parseFloat(tr.querySelector('.unit').value)||0;
      const line = size * unit;
      tr.querySelector('.line').textContent = money(line);
      subtotal += line;
    });

    $('#subtotal').textContent = money(subtotal);

    // discount block
    discBefore.value = Number(subtotal).toFixed(2);
    if(!discOn.checked){
      discAfter.value = Number(subtotal).toFixed(2);
      discAfter.classList.remove('discount-live');
    }else{
      // add neon flash while active
      discAfter.classList.add('discount-live');
      // if empty, prefill with subtotal
      if(discAfter.value === '') discAfter.value = Number(subtotal).toFixed(2);
    }

    const after = parseFloat(discAfter.value)||0;

    // VAT
    const vat = vatOn.checked ? after * 0.20 : 0;
    $('#vat').textContent = money(vat);

    // grand + final today
    const grand = after + vat;
    $('#grand').textContent = money(grand);

    const dep = parseFloat(deposit.value)||0;
    $('#finalToday').value = money(Math.max(grand - dep, 0));
  }

  /* recalc on any change to inputs */
  document.addEventListener('input', e=>{
    if(e.target.matches('input,select,textarea')) recalc();
  });
  recalc();

  /* ---------- signature (touch + mouse) ---------- */
  const canvas = $('#sig');
  const ctx = canvas.getContext('2d',{willReadFrequently:true});
  function sizeCanvas(){
    const rect = canvas.getBoundingClientRect();
    const ratio = window.devicePixelRatio || 1;
    canvas.width = Math.floor(rect.width * ratio);
    canvas.height= Math.floor(240 * ratio);
    ctx.scale(ratio, ratio);
    ctx.lineJoin = 'round';
    ctx.lineCap  = 'round';
    ctx.lineWidth= 3;
    ctx.strokeStyle = '#ff8c1a';
    ctx.fillStyle = '#000';
    ctx.fillRect(0,0,canvas.width,canvas.height);
  }
  sizeCanvas(); addEventListener('resize', sizeCanvas);

  let drawing=false, lastX=0,lastY=0;
  const pos = e => {
    if(e.touches && e.touches.length){ const t=e.touches[0]; const r=canvas.getBoundingClientRect(); return {x:t.clientX-r.left, y:t.clientY-r.top}; }
    const r=canvas.getBoundingClientRect(); return {x:e.clientX-r.left, y:e.clientY-r.top};
  };
  const start = e => { e.preventDefault(); drawing=true; const p=pos(e); lastX=p.x; lastY=p.y; };
  const move  = e => { if(!drawing) return; const p=pos(e); ctx.beginPath(); ctx.moveTo(lastX,lastY); ctx.lineTo(p.x,p.y); ctx.stroke(); lastX=p.x; lastY=p.y; };
  const stop  = () => drawing=false;

  canvas.addEventListener('pointerdown', start);
  canvas.addEventListener('pointermove',  move);
  canvas.addEventListener('pointerup',    stop);
  canvas.addEventListener('pointerleave', stop);
  // iOS Safari fallback
  canvas.addEventListener('touchstart', start,{passive:false});
  canvas.addEventListener('touchmove',  move, {passive:false});
  canvas.addEventListener('touchend',   stop);

  $('#sigClear').addEventListener('click', sizeCanvas);

  /* ---------- stub actions (wired, no 3rd-party libs needed) ---------- */
  async function shareWhatsApp(text){
    const url = 'https://wa.me/?text=' + encodeURIComponent(text);
    window.open(url,'_blank');
  }
  $('#btnWhatsApp').addEventListener('click', ()=>{
    shareWhatsApp(
      `WARM UP UK HOMES\nContract: ${$('#contractNo').value}\nClient: ${$('#client').value}\nTotal: ${$('#grand').textContent}`
    );
  });

  // Save quote (simple file with your values)
  $('#btnSaveQuote').addEventListener('click', ()=>{
    const data = {
      contract: $('#contractNo').value,
      date: $('#date').value,
      client: $('#client').value,
      phone: $('#phone').value,
      address: $('#address').value,
      notes: $('#notes').value,
      grand: $('#grand').textContent,
      finalToday: $('#finalToday').value
    };
    const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `WUUK-${data.contract}.json`;
    a.click();
    URL.revokeObjectURL(a.href);
  });

  // Save PDF (basic print to PDF prompt)
  $('#btnSavePdf').addEventListener('click', ()=>{
    // Most mobile browsers present "Save as PDF" in Print dialog
    window.print();
  });
})();
</script>
</body>
</html>
