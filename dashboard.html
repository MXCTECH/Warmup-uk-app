<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MXCTECH INSULATION — Dashboard</title>
<style>
  :root{
    --black:#0B0B0D;       /* primary background / buttons */
    --blue:#1F6BFF;        /* accents and tabs */
    --red:#E53935;         /* destructive */
    --ink:#111319;         /* deep text */
    --line:#1d212b;        /* borders on dark */
    --muted:#8b93a7;       /* subtle text */
    --soft:#0f121a;        /* cards on dark */
    --chip:#131826;        /* pills */
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(180deg,#06070a,#0b0d12 120%);color:#e9edf7}
  header{display:flex;align-items:center;gap:14px;padding:14px 18px;border-bottom:1px solid var(--line);position:sticky;top:0;background:rgba(6,7,10,.75);backdrop-filter:blur(8px);z-index:10}
  header img{height:40px;width:auto;border-radius:6px}
  header h1{margin:0;font-size:18px;font-weight:800;letter-spacing:.3px}
  header .sub{color:var(--muted);font-weight:600}
  nav{display:flex;gap:8px;padding:10px 12px;border-bottom:1px solid var(--line);position:sticky;top:68px;background:rgba(8,10,14,.7);backdrop-filter:blur(6px);z-index:9}
  .tab{border:1px solid var(--line);background:var(--soft);padding:8px 12px;border-radius:10px;font-weight:800;cursor:pointer;color:#e9edf7}
  .tab.active{outline:2px solid var(--blue)}
  main{padding:16px;max-width:1200px;margin:auto}
  .card{background:var(--soft);border:1px solid var(--line);border-radius:14px;padding:14px;margin-bottom:16px;box-shadow:0 6px 20px rgba(0,0,0,.25)}
  .grid{display:grid;grid-template-columns:repeat(6,1fr);gap:10px}
  label{font-size:12px;color:#aab2c5}
  input,select,textarea{
    width:100%;padding:10px;border:1px solid #22283a;background:#0c101a;color:#e9edf7;border-radius:10px;font-size:14px
  }
  textarea{grid-column:span 6;min-height:74px;resize:vertical}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .btn{border:1px solid #22283a;background:#0c101a;padding:10px 14px;border-radius:10px;font-weight:900;cursor:pointer;color:#e9edf7}
  .btn.primary{background:var(--blue);border-color:var(--blue)}
  .btn.ok{background:#18a46b;border-color:#18a46b}
  .btn.warn{background:var(--red);border-color:var(--red)}
  .btn.dark{background:var(--black);border-color:#000}
  table{width:100%;border-collapse:separate;border-spacing:0}
  th,td{padding:12px;border-bottom:1px solid #202538;text-align:left;font-size:14px;vertical-align:top}
  th{font-size:12px;color:#9aa4bd;text-transform:uppercase;letter-spacing:.3px}
  .pill{display:inline-block;padding:4px 8px;border-radius:999px;background:var(--chip);font-size:12px;color:#b8c0d9}
  .muted{color:#9aa4bd}
  .hide{display:none}
  a{color:#9ec2ff}
  @media (max-width:1000px){ .grid{grid-template-columns:repeat(2,1fr)} }
</style>
</head>
<body>
<header>
  <img src="mxctech-logo.png" alt="MXCTECH INSULATION Logo"/>
  <div>
    <h1>MXCTECH INSULATION</h1>
    <div class="sub">Operations Dashboard</div>
  </div>
</header>

<nav>
  <button class="tab active" data-tab="appointments">Appointments</button>
  <button class="tab" data-tab="install">Install Calendar</button>
</nav>

<main>
  <!-- APPOINTMENTS -->
  <section id="appointments" class="card">
    <h2 style="margin:4px 0 14px">Add Appointment</h2>
    <div class="grid" id="appt-form">
      <div><label>Customer Name</label><input id="custName" placeholder="Jane Smith"/></div>
      <div><label>Phone (mobile for WhatsApp)</label><input id="custPhone" placeholder="+447... or 07..."/></div>
      <div><label>Email</label><input id="custEmail" placeholder="name@email.com"/></div>
      <div><label>Address Line 1</label><input id="addr1" placeholder="1 High Street"/></div>
      <div><label>Postcode</label><input id="postcode" placeholder="SS8 9ET"/></div>
      <div><label>Appointment Date/Time</label><input id="apptDate" type="datetime-local"/></div>
      <div><label>Rep Name</label><input id="repName" placeholder="Your rep"/></div>
      <div><label>Rep WhatsApp (optional)</label><input id="repWhatsApp" placeholder="+447..."/></div>
      <div><label>Lead Source</label>
        <select id="leadSource">
          <option>Facebook</option><option>Google</option><option>Referral</option>
          <option>Website</option><option>Door</option><option>Other</option>
        </select>
      </div>
      <div><label>Job Type</label>
        <select id="jobType">
          <option>Multifoil Insulation</option>
          <option>Spray Foam Removal</option>
          <option>Loft Boarding</option>
          <option>Ventilation</option>
          <option>Other</option>
        </select>
      </div>
      <textarea id="notes" placeholder="Access, parking, pets, roof details…"></textarea>
    </div>

    <div class="row" style="margin-top:10px">
      <button class="btn primary" id="saveAppt">Save Appointment</button>
      <span class="muted">Saved locally on this device.</span>
    </div>

    <h3 style="margin:20px 0 8px">Appointments</h3>
    <div class="card" style="padding:0">
      <table id="apptTable">
        <thead>
          <tr>
            <th>Customer</th><th>Contact</th><th>Address</th>
            <th>When</th><th>Rep</th><th>Type</th><th>Actions</th>
          </tr>
        </thead>
        <tbody><!-- rows --></tbody>
      </table>
    </div>
  </section>

  <!-- INSTALL CALENDAR (reads saved contracts) -->
  <section id="install" class="card hide">
    <h2 style="margin:4px 0 14px">Install Calendar</h2>
    <p class="muted">Shows contracts saved with an Install Date.</p>
    <div class="card" style="padding:0">
      <table id="installTable">
        <thead>
          <tr>
            <th>Install Date</th><th>Customer</th><th>Address</th>
            <th>Job</th><th>Total</th><th>Contract</th>
          </tr>
        </thead>
        <tbody><!-- rows --></tbody>
      </table>
    </div>
  </section>
</main>

<script>
const $ = s=>document.querySelector(s);
const $$ = s=>document.querySelectorAll(s);

// Tabs
$$('.tab').forEach(t=>t.addEventListener('click',()=>{
  $$('.tab').forEach(x=>x.classList.remove('active'));
  t.classList.add('active');
  $('#appointments').classList.toggle('hide', t.dataset.tab!=='appointments');
  $('#install').classList.toggle('hide', t.dataset.tab!=='install');
}));

// Storage helpers
const load = (k,d=[]) => JSON.parse(localStorage.getItem(k)||JSON.stringify(d));
const save = (k,v) => localStorage.setItem(k, JSON.stringify(v));

function loadAppts(){ return load('mxct_appts'); }
function saveAppts(list){ save('mxct_appts', list); renderAppts(); }

function renderAppts(){
  const tbody = $('#apptTable tbody'); tbody.innerHTML='';
  loadAppts().forEach((a,i)=>{
    const tr = document.createElement('tr');
    const when = a.apptDate ? new Date(a.apptDate).toLocaleString() : '';
    tr.innerHTML = `
      <td><strong>${a.custName||''}</strong><div class="muted">${a.leadSource||''}</div></td>
      <td>${a.custPhone||''}<br><span class="muted">${a.custEmail||''}</span></td>
      <td>${a.addr1||''}<br><span class="muted">${a.postcode||''}</span></td>
      <td><span class="pill">${when}</span></td>
      <td>${a.repName||''}</td>
      <td>${a.jobType||''}</td>
      <td class="row">
        <button class="btn dark" onclick="editAppt(${i})">Edit</button>
        <button class="btn warn" onclick="delAppt(${i})">Delete</button>
        <button class="btn primary" onclick="openContract(${i})">Create Contract</button>
        <button class="btn ok" onclick="sendWhatsApp(${i})">Send Contract via WhatsApp</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

function editAppt(i){
  const a = loadAppts()[i]; if(!a) return;
  ['custName','custPhone','custEmail','addr1','postcode','apptDate','repName','repWhatsApp','notes']
    .forEach(id=> $('#'+id).value = a[id] || '');
  $('#leadSource').value = a.leadSource || 'Facebook';
  $('#jobType').value = a.jobType || 'Multifoil Insulation';
  localStorage.setItem('mxct_edit_index', i);
  window.scrollTo({top:0,behavior:'smooth'});
}

function delAppt(i){
  const all = loadAppts(); all.splice(i,1); saveAppts(all);
}

function normPhone(p){
  if(!p) return '';
  let s = p.trim();
  if(s.startsWith('07')) s = '+44' + s.slice(1);
  return s.replace(/\s+/g,'');
}

function contractParams(a){
  return new URLSearchParams({
    custName:a.custName||'', custPhone:normPhone(a.custPhone||''),
    custEmail:a.custEmail||'', addr1:a.addr1||'', postcode:a.postcode||'',
    apptDate:a.apptDate||'', repName:a.repName||'', jobType:a.jobType||'', notes:a.notes||'',
  });
}

function openContract(i){
  const a = loadAppts()[i]; if(!a) return;
  const url = `contract.html?${contractParams(a).toString()}`;
  window.open(url,'_blank');
}

function sendWhatsApp(i){
  const a = loadAppts()[i]; if(!a) return;
  const contractLink = new URL(location.origin + location.pathname.replace('dashboard.html','contract.html'));
  contractLink.search = contractParams(a).toString();

  const text = `Hi ${a.custName||''}, it’s ${a.repName||'our team'} from MXCTECH INSULATION.
Here’s your contract link:
${contractLink.toString()}
Appointment: ${a.apptDate ? new Date(a.apptDate).toLocaleString() : ''}
Address: ${a.addr1||''}, ${a.postcode||''}`;

  const phone = normPhone(a.custPhone||'');
  if(!phone){ alert('No mobile number for WhatsApp.'); return; }
  const url = `https://wa.me/${phone.replace(/\D/g,'')}?text=${encodeURIComponent(text)}`;
  window.open(url,'_blank');
}

$('#saveAppt').addEventListener('click',()=>{
  const i = localStorage.getItem('mxct_edit_index');
  const entry = {
    custName:$('#custName').value.trim(),
    custPhone:$('#custPhone').value.trim(),
    custEmail:$('#custEmail').value.trim(),
    addr1:$('#addr1').value.trim(),
    postcode:$('#postcode').value.trim(),
    apptDate:$('#apptDate').value,
    repName:$('#repName').value.trim(),
    repWhatsApp:$('#repWhatsApp').value.trim(),
    leadSource:$('#leadSource').value,
    jobType:$('#jobType').value,
    notes:$('#notes').value.trim(),
  };
  const all = loadAppts();
  if(i!==null && i!=='null'){ all[Number(i)] = entry; localStorage.removeItem('mxct_edit_index'); }
  else { all.push(entry); }
  saveAppts(all);
  // clear
  ['custName','custPhone','custEmail','addr1','postcode','apptDate','repName','repWhatsApp','notes']
    .forEach(id=>$('#'+id).value='');
  $('#leadSource').value='Facebook'; $('#jobType').value='Multifoil Insulation';
});

function renderInstall(){
  const tbody = $('#installTable tbody'); tbody.innerHTML='';
  const contracts = load('mxct_contracts');
  contracts.sort((a,b)=> (a.installDate||'').localeCompare(b.installDate||''));
  contracts.forEach(c=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${c.installDate ? new Date(c.installDate).toLocaleDateString() : ''}</td>
      <td><strong>${c.custName||''}</strong><div class="muted">${c.custPhone||''}</div></td>
      <td>${c.addr1||''}<br><span class="muted">${c.postcode||''}</span></td>
      <td>${c.jobType||''}</td>
      <td>£${(c.total||0).toFixed(2)}</td>
      <td><a href="contract.html?id=${encodeURIComponent(c.id)}" target="_blank">Open</a></td>`;
    tbody.appendChild(tr);
  });
}

(function init(){ renderAppts(); renderInstall(); })();
</script>
</body>
</html>
