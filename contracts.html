<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>WARM UP UK HOMES — Contract</title>
<meta name="color-scheme" content="dark light">
<style>
:root{
  --bg:#0b0d12;--panel:#121512;--ink:#e7e8e6;
  --gold:#d4af37;--gold-soft:#ffd766;--line:#222;--muted:#9aa0a6;
  --green:#18e44a;--green-ink:#001a06;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--ink);background:var(--bg);}

/* header */
header{position:sticky;top:0;z-index:5;padding:16px 12px 0}
.head{max-width:1100px;margin:0 auto;padding:20px;background:linear-gradient(180deg,#2a2416,#19160c);
border:1px solid #3a341e;border-radius:20px;box-shadow:0 10px 28px rgba(0,0,0,.55);transform:translateY(-18px);
opacity:0;animation:drop .6s ease-out forwards;}
@keyframes drop{to{transform:translateY(0);opacity:1}}
.brand{display:flex;align-items:center;gap:14px}
.brand img{height:40px;border-radius:8px;box-shadow:0 0 0 1px #3a341e}
.brand h1{margin:0;font-size:30px;letter-spacing:.05em;line-height:1.1}
.brand small{display:block;color:#c6b273;margin-top:6px}
.actions{display:flex;gap:12px;margin-top:14px;flex-wrap:wrap}
.btn{appearance:none;border:1px solid #5b4d22;border-radius:14px;padding:12px 16px;color:var(--ink);
background:linear-gradient(180deg,#d6b756,#caa93b);font-weight:700;cursor:pointer;box-shadow:0 2px 0 0 #7f6a2d inset;}
.btn.secondary{background:none;border-color:#5b4d22;box-shadow:none}
.btn:active{transform:translateY(1px)}

/* main form */
.wrap{max-width:1100px;margin:18px auto 90px;padding:0 12px}
.card{background:#111312;border:1px solid #222;border-radius:18px;padding:18px;box-shadow:0 10px 28px rgba(0,0,0,.4);margin-bottom:14px}
h2{margin:0 0 14px;letter-spacing:.08em;color:var(--gold)}
.row{display:grid;grid-template-columns:1fr;gap:10px}
@media(min-width:720px){.row{grid-template-columns:1fr 1fr}}
label{font-size:14px;color:var(--muted)}
.input,select,textarea{width:100%;border:1px solid #303336;background:#0d0f10;color:var(--ink);border-radius:14px;padding:14px;font-size:16px;outline:none}
textarea{min-height:120px;resize:vertical}

/* products */
.table{display:grid;gap:10px}
.line{display:grid;grid-template-columns:1fr 86px 120px 120px 50px;gap:8px;align-items:center}
.del{border:1px solid #423;background:#1b0f10;color:#f3b;border-radius:12px;height:44px;cursor:pointer}
.addline{justify-self:start}
hr.soft{border:none;height:1px;background:#26292b;margin:14px 0}

/* toggles */
.switch{display:flex;align-items:center;gap:10px}
.switch input{appearance:none;width:46px;height:26px;border-radius:26px;background:#202426;position:relative;outline:none;border:1px solid #333;cursor:pointer}
.switch input::after{content:"";position:absolute;top:2px;left:2px;width:20px;height:20px;border-radius:50%;background:#9aa0a6;transition:all .18s ease}
.switch input:checked{background:var(--green)}
.switch input:checked::after{left:24px;background:#fff}

/* discount highlight */
@keyframes flash{0%,100%{box-shadow:0 0 0 0 rgba(24,228,74,.0)}50%{box-shadow:0 0 10px 3px rgba(24,228,74,.55)}}
.flash-on{background:#05270f;border-color:#1b7d33;animation:flash 1.1s ease-in-out infinite}
.help{color:#8f939a;font-size:13px}

/* totals */
.tot{display:grid;grid-template-columns:1fr 160px;gap:10px;align-items:center}
.tot .value{border:1px dashed #4b4e52;border-radius:14px;padding:10px 14px;text-align:right;min-height:44px;display:flex;align-items:center;justify-content:flex-end}
.big{font-size:26px;font-weight:800}
.em{border-color:#7a6422;background:rgba(212,175,55,.06)}

/* signature */
.sig-box{border:1px dashed #3a3f44;border-radius:14px;padding:8px}
canvas#sig{width:100%;height:160px;background:#0d0f10;border-radius:10px;touch-action:none}
.sig-actions{display:flex;gap:10px;margin-top:8px}

/* store mode bar */
#storebar{
 position:fixed;bottom:0;left:0;right:0;background:linear-gradient(180deg,#1a1a1a,#0e0e0e);
 border-top:2px solid #d4af37;display:flex;align-items:center;justify-content:space-between;
 padding:8px 16px;z-index:10;box-shadow:0 -2px 10px rgba(212,175,55,.25);
}
#storebar img{height:30px;width:auto;border-radius:6px;margin-right:10px}
#storebar .logoarea{display:flex;align-items:center}
#storebar .mini-btns{display:flex;gap:8px}
#storebar .mini-btns .btn{padding:6px 10px;font-size:14px}

/* print */
@media print{
  header,.btn,#storebar{display:none!important}
  body{background:#fff;color:#000}
  .card{break-inside:avoid}
}
</style>
</head>
<body>

<header>
  <div class="head">
    <div class="brand">
      <img src="assets/warmupuk-logo.png.PNG" alt="Warm Up UK Homes logo">
      <div><h1>WARM UP<br>UK HOMES</h1><small>Contract Builder · Black & Gold Theme</small></div>
    </div>
    <div class="actions">
      <button type="button" id="btnPrint" class="btn">Print / Save PDF</button>
      <a href="#" id="btnWhatsApp" class="btn secondary">Share via WhatsApp</a>
    </div>
  </div>
</header>

<main class="wrap">

  <!-- Contract / Client -->
  <section class="card">
    <div class="row">
      <div><label>Contract Number</label><input id="contractNo" class="input" placeholder="WUUK-YYYYMMDD-XXXX"></div>
      <div><label>Date</label><input id="date" class="input" type="date"></div>
    </div>
  </section>

  <section class="card">
    <h2>CLIENT & JOB DETAILS</h2>
    <div class="row">
      <div><label>Client name</label><input id="client" class="input" placeholder="Full name"></div>
      <div><label>Contact number (WhatsApp)</label><input id="phone" class="input" placeholder="+44... or 07..."></div>
      <div><label>Property address</label><input id="address" class="input" placeholder="Address, Postcode"></div>
      <div><label>Rep</label><input id="rep" class="input" placeholder="Rep name"></div>
      <div><label>Job type</label>
        <select id="jobType" class="input">
          <option>Loft Insulation</option><option>Underfloor Insulation</option><option>Room in Roof</option><option>Other</option>
        </select>
      </div>
      <div><label>Install date</label><input id="install" class="input" type="date"></div>
    </div>
  </section>

  <!-- Products & Pricing -->
  <section class="card" id="productsCard">
    <h2>PRODUCTS & PRICING</h2>
    <div class="table" id="lines"></div>
    <button class="btn secondary addline" id="addLine">+ Add line</button>
    <hr class="soft">
    <div class="row">
      <div class="switch"><label>Apply VAT (20%)</label><input id="vat" type="checkbox" checked></div>
      <div class="switch"><label>Discounts</label><input id="discountEnabled" type="checkbox"></div>
    </div>
    <div class="row" id="discountRow" style="margin-top:8px">
      <div><label>Discount (before VAT)</label><input id="discountBefore" class="input money" placeholder="0.00" disabled></div>
      <div><label>Discount (after VAT)</label><input id="discountAfter" class="input money" placeholder="0.00" disabled></div>
    </div>
    <div class="row" style="margin-top:10px">
      <div class="switch"><label>Deposit helpers</label></div>
      <div style="display:flex;gap:10px;justify-content:flex-end">
        <button type="button" class="btn secondary" id="dep20">Deposit 20%</button>
        <button type="button" class="btn secondary" id="dep25">Deposit 25%</button>
        <button type="button" class="btn secondary" id="depClear">Clear</button>
      </div>
    </div>
    <hr class="soft">
    <div class="tot"><div>Subtotal</div><div id="tSubtotal" class="value">£0.00</div>
      <div>VAT (20%)</div><div id="tVat" class="value">£0.00</div></div>
    <div class="tot"><div class="big">Grand Total</div><div id="tGrand" class="value em big">£0</div></div>
    <div class="tot"><div><label>Deposit (paid / due now)</label><input id="depositPaid" class="input money" placeholder="0"></div><div id="tDepositEcho" class="value">£0.00</div></div>
    <div class="tot"><div class="big">Final to Pay Today</div><div id="tFinalToday" class="value em big">£0</div>
      <div>Balance Due on Completion</div><div id="tBalance" class="value">£0.00</div></div>
  </section>

  <!-- Notes -->
  <section class="card">
    <h2>NOTES / INSTRUCTIONS</h2>
    <textarea id="notes" class="input" placeholder="Write installation notes or client instructions..."></textarea>
  </section>

  <!-- Signature -->
  <section class="card">
    <h2>SIGNATURES</h2>
    <div class="row">
      <div class="sig-box"><label>Client signature</label><canvas id="sig"></canvas><div class="sig-actions"><button type="button" class="btn secondary" id="clearSig">Clear</button></div></div>
      <div class="sig-box"><label>Office</label><div style="font-size:13px;color:#8f939a">Fitzwilliam House, Middle Bank, Doncaster, DN4 5NG<br>Tel 07470 474 774 · warmupuk@icloud.com</div></div>
    </div>
  </section>
</main>

<!-- Store Mode Footer -->
<div id="storebar">
  <div class="logoarea">
    <img src="assets/warmupuk-logo.png.PNG" alt="Warm Up UK Homes">
    <strong>Warm Up UK Store Mode</strong>
  </div>
  <div class="mini-btns">
    <button class="btn secondary" id="gotoDash">Dashboard</button>
    <button class="btn secondary" id="gotoWhatsApp">WhatsApp</button>
    <button class="btn secondary" id="gotoPDF">PDF</button>
  </div>
</div>

<script>
const el=id=>document.getElementById(id);
const num=v=>{const n=parseFloat(String(v).replace(/[^0-9.\-]/g,''));return isFinite(n)?n:0;}
const money=n=>'£'+Number(n||0).toFixed(2);

/* Auto Date + Contract Number */
(function(){const d=el('date');if(d&&!d.value)d.valueAsNumber=Date.now()-new Date().getTimezoneOffset()*60000;
const cn=el('contractNo');if(cn&&!cn.value){const pad=n=>String(n).padStart(2,'0');const t=new Date();cn.value=`WUUK-${t.getFullYear()}${pad(t.getMonth()+1)}${pad(t.getDate())}-${Math.random().toString(36).slice(2,6).toUpperCase()}`}})();

/* Products */
const linesEl=document.querySelector('#lines');
function addLine(desc='Loft insulation',q=1,u=0){const r=document.createElement('div');
r.className='line';r.innerHTML=`<input class="input desc" value="${desc}"><input class="input qty" value="${q}">
<input class="input money unit" value="${u}"><input class="input money total" readonly value="0.00">
<button type="button" class="del">×</button>`;
r.querySelectorAll('input').forEach(i=>i.addEventListener('input',calc));
r.querySelector('.del').onclick=()=>{r.remove();calc()};
linesEl.appendChild(r);calc();}
el('addLine').onclick=()=>addLine('',1,0);addLine();

/* Discount logic */
let active=null;
function updateDiscount(){const on=el('discountEnabled').checked;
['discountBefore','discountAfter'].forEach(id=>{const i=el(id);i.disabled=!on;if(!on)i.classList.remove('flash-on')});
if(!on)active=null;calc();}
el('discountEnabled').onchange=updateDiscount;
['discountBefore','discountAfter'].forEach(id=>{
  const inp=el(id);
  inp.onfocus=()=>{active=id;el('discountBefore').classList.toggle('flash-on',id==='discountBefore');
  el('discountAfter').classList.toggle('flash-on',id==='discountAfter');calc();}
  inp.oninput=calc;
});

/* VAT & Deposit */
['vat','depositPaid'].forEach(i=>el(i).oninput=calc);
el('dep20').onclick=()=>setDep(20);el('dep25').onclick=()=>setDep(25);el('depClear').onclick=()=>{el('depositPaid').value='';calc();}

/* Calc */
function calc(){
 let subtotal=0;
 document.querySelectorAll('.line').forEach(r=>{
  const q=num(r.querySelector('.qty').value),u=num(r.querySelector('.unit').value);
  const t=q*u;subtotal+=t;r.querySelector('.total').value=t.toFixed(2);
 });
 let discBefore=0,discAfter=0;
 if(el('discountEnabled').checked){
   if(active==='discountBefore')discBefore=Math.min(num(el('discountBefore').value),subtotal);
 }
 let sub=subtotal-discBefore;
 const vatOn=el('vat').checked;let vat=vatOn?sub*0.2:0;let grand=sub+vat;
 if(el('discountEnabled').checked&&active==='discountAfter')discAfter=Math.min(num(el('discountAfter').value),grand);
 grand-=discAfter;
 const dep=num(el('depositPaid').value);const final=Math.max(0,grand-dep);
 el('tSubtotal').textContent=money(sub);el('tVat').textContent=money(vat);
 el('tGrand').textContent=money(grand);el('tDepositEcho').textContent=money(dep);
 el('tFinalToday').textContent=money(final);el('tBalance').textContent=money(final);
 window.totals={subtotal:sub,vat,grand,final};
}
function setDep(p){calc();el('depositPaid').value=((window.totals?.grand||0)*(p/100)).toFixed(2);calc();}
calc();

/* Signature */
(()=>{const c=el('sig'),x=c.getContext('2d');let d=false,last=null;function s(e){d=true;last=p(e);}
function m(e){if(!d)return;const pt=p(e);x.beginPath();x.moveTo(last.x,last.y);x.lineTo(pt.x,pt.y);x.strokeStyle="#fff";x.lineWidth=2.5;x.stroke();last=pt;}
function e(){d=false;}
function p(ev){const r=c.getBoundingClientRect();const t=ev.touches?ev.touches[0]:ev;return{x:t.clientX-r.left
