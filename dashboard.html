<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Warm Up UK ‚Äî Dashboard</title>
<style>
  :root{
    --bg:#0b0d12;
    --panel:#12151c;
    --panel-2:#0f1218;
    --gold:#d4af37;
    --ink:#e7e8ea;
    --muted:#9aa3ad;
    --line:#212632;
    --danger:#c62828;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--ink);background:var(--bg);}
  .hidden{display:none}
  .divider{height:1px;background:var(--line);margin:14px 0}
  .goldbar{height:6px;background:var(--gold)}
  header{position:sticky;top:0;z-index:10;background:var(--panel);border-bottom:1px solid var(--line);}
  .head-wrap{max-width:1100px;margin:0 auto;padding:12px 16px;display:flex;align-items:center;gap:12px}
  .brand h1{font-size:18px;margin:0;color:var(--ink)}
  .brand p{margin:2px 0 0 0;font-size:12px;color:var(--muted)}
  .wrap{max-width:1100px;margin:20px auto 48px;padding:0 16px}
  .card{background:linear-gradient(180deg,var(--panel),var(--panel-2));border:1px solid var(--line);border-radius:14px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,.25)}
  .card h2{margin:0;padding:14px 16px;border-bottom:1px solid var(--line);font-size:16px;font-weight:700;color:var(--gold);background:rgba(212,175,55,.05)}
  .card .body{padding:16px}
  label{display:block;font-size:12px;margin-bottom:6px;color:var(--muted);text-transform:uppercase;letter-spacing:.03em}
  input,select,textarea{width:100%;padding:11px 12px;border:1px solid var(--line);border-radius:10px;background:#0c1016;color:var(--ink);font-size:14px}
  input::placeholder,textarea::placeholder{color:#6f7782}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
  @media (max-width:880px){.row,.row3{grid-template-columns:1fr}}
  .actions{display:flex;flex-wrap:wrap;gap:10px;margin-top:14px}
  button,.btn{appearance:none;border:0;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
  .btn-primary{background:var(--gold);color:#000}
  .btn-outline{background:transparent;border:1px solid var(--line);color:var(--ink)}
  .btn-danger{background:var(--danger);color:#fff}
  .btn-ok{background:#2a2f3a;color:var(--gold);border:1px solid rgba(212,175,55,.35)}
  .pill{font-size:12px;padding:4px 8px;border-radius:999px;background:rgba(212,175,55,.12);color:var(--gold);border:1px solid rgba(212,175,55,.35)}
  .list{padding:0;margin:0;list-style:none}
  .item{padding:12px 14px;border-top:1px solid var(--line);display:flex;justify-content:space-between;align-items:center;gap:10px}
  .item strong{display:block;font-size:14px;color:var(--ink)}
  .item small{color:var(--muted)}
  .hl{background:rgba(212,175,55,.08);border:1px dashed rgba(212,175,55,.45);padding:10px;border-radius:10px;font-size:13px;color:var(--ink)}
  /* Contract hero (matches your screenshot) */
  .contract-hero{text-align:center;padding:18px 12px 6px 12px}
  .contract-hero img{height:38px;width:auto;filter:brightness(1.05) saturate(1.1)}
  .contract-hero .uk{font-weight:800;font-size:28px;color:var(--gold)}
  .contract-hero .brandline{margin-top:6px;font-size:16px;letter-spacing:.3em;color:#fff}
  .contract-hero .title{margin-top:14px;font-size:20px;color:var(--gold);font-weight:800;letter-spacing:.1em}
  .contract-hero .ref{margin-top:6px;color:var(--muted);font-size:12px}
  .contract-hero .goldbar-thin{height:6px;background:var(--gold);margin-top:12px;border-radius:3px}
  .terms{border:1px solid var(--line);border-radius:10px;padding:10px;background:#0c1016;max-height:160px;overflow:auto;font-size:12px;color:#d9dee6}
  .sig-wrap{border:1px dashed rgba(212,175,55,.45);border-radius:10px;padding:10px;background:#0c1016}
  .sig-canvas{width:100%;height:180px;border:1px solid var(--line);border-radius:8px;background:#0a0e14;touch-action:none}
  .sig-actions{display:flex;gap:8px;margin-top:8px}
  .footer{margin-top:18px;padding:14px 0 4px 0;text-align:center;color:var(--muted)}
  .footer .line{height:1px;background:linear-gradient(90deg,transparent,var(--gold),transparent);margin-bottom:8px;opacity:.6}
  .footer .content{font-size:12px;line-height:1.4}
  .footer .content b{color:var(--gold)}
  /* Print */
  .no-print{} .print-only{display:none}
  @media print{
    header{position:static;box-shadow:none}
    .no-print{display:none !important}
    .print-only{display:block !important}
    body{background:#000;color:#fff}
    .card{border:none;box-shadow:none}
    .wrap{margin:0;max-width:100%;padding:0 10mm}
    a{color:inherit;text-decoration:none}
  }
</style>
</head>
<body>
<div class="goldbar"></div>
<header>
  <div class="head-wrap">
    <div class="brand">
      <h1>WARM UP UK ‚Äî Dashboard</h1>
      <p>Appointment Calendar ¬∑ WhatsApp ¬∑ Contract ¬∑ Signature ¬∑ PDF</p>
    </div>
  </div>
</header>

<div class="wrap">
  <!-- CALENDAR -->
  <section id="calendarView" class="view card">
    <h2>Appointment Calendar ‚Äî Add Booking</h2>
    <div class="body">
      <div class="hl">Fill this in, then click <b>Open Contract</b> (pre-filled) or use <b>Send to WhatsApp</b> to share a contract link.</div>
      <div class="divider"></div>
      <form id="apptForm">
        <div class="row">
          <div><label>Client Name</label><input id="clientName" required placeholder="e.g. Jane Smith" /></div>
          <div><label>Phone (UK)</label><input id="phone" required placeholder="e.g. 07123 456789" /></div>
        </div>
        <div class="row">
          <div><label>Email</label><input id="email" placeholder="e.g. jane@email.com" /></div>
          <div><label>Postcode</label><input id="postcode" placeholder="e.g. RM6 6AX" /></div>
        </div>
        <div><label>Address</label><input id="address1" placeholder="321‚Äì323 High Street, Romford" /></div>
        <div class="row3">
          <div>
            <label>Product</label>
            <select id="product">
              <option value="">‚Äî Select ‚Äî</option>
              <option>Loft Insulation (Multifoil)</option>
              <option>Spray-Foam Removal</option>
              <option>Loft Boarding & Ladder</option>
              <option>Rafter Insulation (Pitched Roof)</option>
            </select>
          </div>
          <div><label>Quoted Price (¬£)</label><input id="price" type="number" step="0.01" /></div>
          <div><label>Appointment Date & Time</label><input id="apptDate" type="datetime-local" /></div>
        </div>
        <div class="row3">
          <div><label>Rep</label><input id="rep" placeholder="e.g. Oliver" /></div>
          <div><label>Booking Agent</label><input id="bookingAgent" placeholder="e.g. Trina" /></div>
          <div><label>Confirmer</label><input id="confirmer" placeholder="Name (if different)" /></div>
        </div>
        <div class="actions">
          <button type="button" class="btn btn-primary" id="saveApptBtn">Save Appointment</button>
          <button type="button" class="btn btn-ok" id="openContractBtn">Open Contract</button>
          <a id="waLink" class="btn btn-outline" href="#" target="_blank" rel="noopener">Send to WhatsApp</a>
          <button type="reset" class="btn btn-outline">Clear</button>
        </div>
      </form>

      <div class="divider"></div>
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 style="margin:0;font-size:15px">Saved Appointments</h3>
        <span id="apptCount" class="pill">0 saved</span>
      </div>
      <ul id="apptList" class="list"></ul>
      <div class="actions"><button class="btn btn-danger" id="clearAllBtn">Delete All</button></div>
      <p class="muted" style="font-size:12px">Saved locally in your browser (localStorage).</p>
    </div>
  </section>

  <!-- CONTRACT -->
  <section id="contractView" class="view card hidden">
    <div class="contract-hero">
      <img src="WUUK.JPG" alt="Warm Up UK Logo" />
      <div class="uk">UK</div>
      <div class="brandline">W A R M &nbsp; U P &nbsp; U K</div>
      <div class="title">CONTRACT</div>
      <div class="ref" id="contractRef">WUK-‚Äî</div>
      <div class="goldbar-thin"></div>
    </div>

    <div class="body">
      <div class="row"><div><label>Client Name</label><input id="c_clientName" /></div><div><label>Phone</label><input id="c_phone" /></div></div>
      <div class="row"><div><label>Email</label><input id="c_email" /></div><div><label>Postcode</label><input id="c_postcode" /></div></div>
      <div><label>Address</label><input id="c_address1" /></div>
      <div class="row3" style="margin-top:8px">
        <div><label>Product</label><input id="c_product" /></div>
        <div><label>Quoted Price (¬£)</label><input id="c_price" type="number" step="0.01" /></div>
        <div><label>Appointment</label><input id="c_apptDate" type="datetime-local" /></div>
      </div>
      <div class="row3" style="margin-top:8px">
        <div><label>Rep</label><input id="c_rep" /></div>
        <div><label>Booking Agent</label><input id="c_bookingAgent" /></div>
        <div><label>Confirmer</label><input id="c_confirmer" /></div>
      </div>

      <div class="divider"></div>
      <h3 style="margin-top:0;color:var(--gold)">Terms & Conditions</h3>
      <div class="terms">
        <ol>
          <li>All works carried out to a professional standard. Materials meet relevant UK standards.</li>
          <li>Customer provides clear access to working area and discloses known hazards.</li>
          <li>Quoted price valid for 30 days; changes to scope may require a revised quote.</li>
          <li>Payment terms: 50% deposit on booking, balance on completion unless agreed in writing.</li>
          <li>Cancellation within 48 hours of appointment may incur a call-out fee.</li>
          <li>Guarantees: workmanship 12 months unless stated. Manufacturer warranties apply.</li>
          <li>By signing you agree to the scope of works and these terms.</li>
        </ol>
      </div>
      <div style="margin-top:10px;display:flex;align-items:center;gap:10px">
        <input type="checkbox" id="c_agree" />
        <label for="c_agree" style="margin:0">I agree to the Terms & Conditions</label>
      </div>

      <div class="divider"></div>
      <h3 style="margin-top:0;color:var(--gold)">Signature</h3>
      <div class="sig-wrap">
        <canvas id="sigCanvas" class="sig-canvas"></canvas>
        <div class="sig-actions no-print">
          <button class="btn btn-outline" id="sigClearBtn">Clear</button>
          <button class="btn btn-outline" id="sigUndoBtn">Undo</button>
        </div>
        <img id="sigImg" class="hidden" alt="Signature Image" />
      </div>

      <div class="actions no-print" style="margin-top:14px">
        <button class="btn btn-primary" id="saveContractBtn">Save Changes</button>
        <button class="btn btn-outline" id="backToCalBtn">Back to Calendar</button>
        <button class="btn btn-outline" id="copyLinkBtn">Copy Contract Link</button>
        <button class="btn btn-ok" id="savePdfBtn">Save as PDF</button>
      </div>

      <div class="print-only" style="margin-top:12px;color:var(--muted)">
        <p style="font-size:12px">Generated: <span id="printTimestamp"></span></p>
      </div>

      <div class="footer">
        <div class="line"></div>
        <div class="content">
          <b>Warm Up UK Ltd</b><br />
          321‚Äì323 High Street, Romford, Essex RM6 6AX<br />
          üìû 01708 300 670 &nbsp; | &nbsp; ‚úâÔ∏è admin@warmupuk.com &nbsp; | &nbsp; üåê www.warmupuk.com
        </div>
      </div>
    </div>
  </section>
</div>

<script>
/* ------- Helpers & state ------- */
const $ = id => document.getElementById(id);
const params = new URLSearchParams(location.search);
const VIEW = params.get('view') || 'calendar';

const idsCal = ['clientName','phone','email','postcode','address1','product','price','apptDate','rep','bookingAgent','confirmer','contractNo'];

function pad(n){return n.toString().padStart(2,'0');}
function generateContractNo(d=new Date()){
  return `WUK-${d.getFullYear().toString().slice(-2)}${pad(d.getMonth()+1)}${pad(d.getDate())}-${Math.floor(Math.random()*1e9).toString().padStart(9,'0')}`;
}
function humanDate(dt){ if(!dt) return ''; try{ return new Date(dt).toLocaleString(); }catch(e){ return dt; } }
function encodePhone(raw){ if(!raw) return ''; let d=(''+raw).replace(/\D+/g,''); if(d.startsWith('0')) d='44'+d.slice(1); return d; }
function objToQuery(o){ const p=new URLSearchParams(); Object.entries(o).forEach(([k,v])=>{ if(v!=null && v!=='') p.set(k,v); }); return p.toString(); }
function formToObj(){ const o={}; idsCal.forEach(id=>{ const el=$(id); if(el) o[id]=el.value; }); return o; }
function fillContract(o){
  const map={clientName:o.clientName,phone:o.phone,email:o.email,postcode:o.postcode,address1:o.address1,product:o.product,price:o.price,apptDate:o.apptDate,rep:o.rep,bookingAgent:o.bookingAgent,confirmer:o.confirmer};
  Object.entries(map).forEach(([k,v])=>{ const el=$('c_'+k); if(el) el.value=v||''; });
}

/* ------- Storage ------- */
function getAppts(){ try{return JSON.parse(localStorage.getItem('wuuk_appts')||'[]')}catch(e){return[]} }
function setAppts(list){ localStorage.setItem('wuuk_appts',JSON.stringify(list)); renderList(); }

/* ------- Views ------- */
function show(v){ $('calendarView').classList.toggle('hidden',v==='contract'); $('contractView').classList.toggle('hidden',v!=='contract'); }

/* ------- WhatsApp ------- */
function waLinkFrom(d){
  const link = location.origin + location.pathname + '?view=contract&' + objToQuery(d);
  const msg = `Hi ${d.clientName||''}, this is Warm Up UK.\n\nContract: ${d.contractNo||''}\nDetails: ${link}\n\nAppointment: ${humanDate(d.apptDate)||'TBC'}\nProduct: ${d.product||''}\nQuoted: ¬£${d.price||''}\nRep: ${d.rep||''}`;
  return 'https://wa.me/'+encodePhone(d.phone)+'?text='+encodeURIComponent(msg);
}
function updateWA(){ const d=formToObj(); if(!d.contractNo) d.contractNo=$('contractRef')?.textContent || ''; const a=$('waLink'); if(!d.phone){a.href='#';return;} a.href=waLinkFrom(d); }

/* ------- Calendar actions ------- */
function renderList(){
  const list=getAppts(), ul=$('apptList'); $('apptCount').textContent=list.length+' saved'; ul.innerHTML='';
  list.forEach(a=>{
    const li=document.createElement('li'); li.className='item';
    li.innerHTML=`<div><strong>${a.clientName||'Unnamed'}</strong><small>${a.product||''} ¬∑ <b style="color:#d4af37">${a.contractNo||''}</b></small></div><div><button class="btn btn-outline" data-id="${a.id}">Open</button></div>`;
    ul.appendChild(li);
  });
}
function saveAppt(){
  const d=formToObj();
  if(!d.contractNo) d.contractNo=generateContractNo();
  d.id = d.id || ('a_'+Date.now());
  const list=getAppts(); const i=list.findIndex(x=>x.id===d.id);
  i>=0?list[i]=d:list.unshift(d); setAppts(list);
  alert('Saved: '+d.contractNo);
  updateWA();
}
function openAppt(a){ if(!a) return; idsCal.forEach(id=>{ const el=$(id); if(el) el.value=a[id]||''; }); updateWA(); goContract(a); }
function goContract(d){
  if(!d.contractNo) d.contractNo=generateContractNo();
  const q=objToQuery(d); history.pushState(null,'',location.pathname+'?view=contract&'+q);
  // hydrate contract view
  $('contractRef').textContent=d.contractNo;
  fillContract(d);
  show('contract');
}

/* ------- Contract actions ------- */
function primeFromParams(){
  const p=new URLSearchParams(location.search); const d={};
  idsCal.forEach(k=>d[k]=p.get(k)||'');
  if(!d.contractNo) d.contractNo=generateContractNo();
  $('contractRef').textContent=d.contractNo;
  fillContract(d);
  // also prime WA with same details
  idsCal.forEach(k=>{ const el=$(k); if(el) el.value=d[k]||''; });
  updateWA();
}
function copyLink(){
  const d=formToObj();
  if(!d.contractNo) d.contractNo=$('contractRef').textContent||generateContractNo();
  const url=location.origin+location.pathname+'?view=contract&'+objToQuery(d);
  navigator.clipboard.writeText(url).then(()=>alert('Contract link copied'),()=>{prompt('Copy this link:',url)});
}
function saveContractEdits(){
  const list=getAppts(), ref=$('contractRef').textContent;
  const idx=list.findIndex(x=>x.contractNo===ref);
  const updated={
    clientName:$('c_clientName').value, phone:$('c_phone').value, email:$('c_email').value,
    postcode:$('c_postcode').value, address1:$('c_address1').value, product:$('c_product').value,
    price:$('c_price').value, apptDate:$('c_apptDate').value, rep:$('c_rep').value,
    bookingAgent:$('c_bookingAgent').value, confirmer:$('c_confirmer').value,
    contractNo:ref, id: idx>=0?list[idx].id:('a_'+Date.now())
  };
  if(idx>=0) list[idx]=updated; else list.unshift(updated);
  setAppts(list); alert('Contract saved.');
}

/* ------- Signature pad ------- */
let sigCanvas, sigCtx, drawing=false, sigPaths=[];
function resizeSig(){
  const ratio=Math.max(window.devicePixelRatio||1,1);
  const r=sigCanvas.getBoundingClientRect();
  sigCanvas.width=r.width*ratio; sigCanvas.height=r.height*ratio;
  sigCtx.setTransform(1,0,0,1,0,0); sigCtx.scale(ratio,ratio); redrawSig();
}
function redrawSig(){
  sigCtx.clearRect(0,0,sigCanvas.width,sigCanvas.height);
  sigCtx.lineWidth=2; sigCtx.lineJoin='round'; sigCtx.lineCap='round'; sigCtx.strokeStyle='#eee';
  sigPaths.forEach(p=>{ if(p.length<2) return; sigCtx.beginPath(); sigCtx.moveTo(p[0].x,p[0].y); for(let i=1;i<p.length;i++) sigCtx.lineTo(p[i].x,p[i].y); sigCtx.stroke(); });
}
function point(e){const r=sigCanvas.getBoundingClientRect(); const t=e.touches?.[0]; const x=(t?t.clientX:e.clientX)-r.left; const y=(t?t.clientY:e.clientY)-r.top; return {x,y};}
function startSig(e){e.preventDefault(); drawing=true; const p=point(e); sigPaths.push([p]); redrawSig();}
function moveSig(e){ if(!drawing) return; e.preventDefault(); const p=point(e); sigPaths[sigPaths.length-1].push(p); redrawSig(); }
function endSig(e){e.preventDefault(); drawing=false;}
function setSigImg(){ const url=sigCanvas.toDataURL('image/png'); const img=$('sigImg'); img.src=url; img.classList.remove('hidden'); }

/* ------- Print to PDF ------- */
function savePdf(){
  if(!$('c_agree').checked){ alert('Please tick "I agree to the Terms & Conditions" first.'); return; }
  $('printTimestamp').textContent=new Date().toLocaleString();
  setSigImg();
  window.print();
}

/* ------- Wiring ------- */
window.addEventListener('DOMContentLoaded', ()=>{
  // initial view
  if(location.search.includes('view=contract')){ show('contract'); primeFromParams(); }
  else{ show('calendar'); }
  // list + buttons
  renderList();
  $('apptList').addEventListener('click',e=>{const id=e.target?.dataset?.id; if(!id) return; const a=getAppts().find(x=>x.id===id); openAppt(a);});
  $('saveApptBtn').onclick=saveAppt;
  $('openContractBtn').onclick=()=>goContract(formToObj());
  $('clearAllBtn').onclick=()=>{ if(confirm('Delete all saved appointments?')){ localStorage.removeItem('wuuk_appts'); renderList(); } };
  // update WA on input
  ['clientName','phone','email','postcode','address1','product','price','apptDate','rep','bookingAgent','confirmer'].forEach(id=>{
    const el=$(id); if(el){ el.addEventListener('input',updateWA); el.addEventListener('change',updateWA); }
  });
  updateWA();
  // contract buttons
  $('backToCalBtn').onclick=()=>{ history.pushState(null,'',location.pathname+'?view=calendar'); show('calendar'); };
  $('copyLinkBtn').onclick=copyLink;
  $('saveContractBtn').onclick=saveContractEdits;
  $('savePdfBtn').onclick=savePdf;
  // signature
  sigCanvas=$('sigCanvas'); sigCtx=sigCanvas.getContext('2d'); resizeSig();
  window.addEventListener('resize',resizeSig);
  sigCanvas.addEventListener('mousedown',startSig);
  sigCanvas.addEventListener('mousemove',moveSig);
  window.addEventListener('mouseup',endSig);
  sigCanvas.addEventListener('touchstart',startSig,{passive:false});
  sigCanvas.addEventListener('touchmove',moveSig,{passive:false});
  sigCanvas.addEventListener('touchend',endSig,{passive:false});
});
</script>
</body>
</html>
