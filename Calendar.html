<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Warm Up UK ‚Äì Calendar</title>
<style>
  :root{
    --bg:#0b0b0c; --panel:#141416; --line:#2a2a2f;
    --gold:#ffc94d; --gold2:#d7ac3a; --text:#f5f5f7; --muted:#b0b3b8;
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:radial-gradient(1200px 600px at 50% 15%, #17171a 0%, var(--bg) 50%, #000 100%);
    color:var(--text); font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    min-height:100vh;
  }
  .wrap{max-width:860px; margin:20px auto; padding:16px}
  h1{margin:0 0 12px; color:var(--gold); letter-spacing:.04em; text-shadow:0 0 14px rgba(255,201,77,.35)}
  .card{background:var(--panel); border:1px solid var(--line); border-radius:14px; padding:16px}
  label{display:block; font-size:13px; color:#c8cbd1; margin:10px 0 6px}
  input, select, textarea{
    width:100%; padding:12px; border-radius:12px; background:#0f1114; color:var(--text); border:1px solid #272a31; outline:none
  }
  textarea{min-height:110px}
  .grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px}
  .btn{appearance:none; border:0; border-radius:12px; padding:12px 16px; font-weight:800; cursor:pointer; color:#0f0f0f;
       background:linear-gradient(180deg, var(--gold), var(--gold2)); box-shadow:0 12px 28px rgba(255,201,77,.25)}
  .btn.secondary{background:#22252b; color:#eef; border:1px solid #323741; box-shadow:none}
  .bar{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
  .note{color:#9aa0a6; font-size:12px; margin-top:8px}
  .hdr{display:flex; align-items:center; justify-content:space-between; margin-bottom:12px}
  .back a{color:var(--gold); text-decoration:none; font-weight:700}
</style>
</head>
<body>
<div class="wrap">
  <div class="hdr">
    <h1>Appointments</h1>
    <div class="back"><a href="/Warmup-uk-app/dashboard.html">‚Üê Back to Dashboard</a></div>
  </div>

  <div class="card">
    <div class="grid">
      <div>
        <label>Client Name</label>
        <input name="name" placeholder="Full name" />
      </div>
      <div>
        <label>Phone (WhatsApp)</label>
        <input name="phone" placeholder="+44‚Ä¶" />
      </div>
      <div style="grid-column:1/-1">
        <label>Address</label>
        <input name="address" placeholder="321‚Äì323 High Road, Romford, Essex RM6 6AX" />
      </div>
      <div>
        <label>Date</label>
        <input type="date" name="date" />
      </div>
      <div>
        <label>Time</label>
        <input type="time" name="time" />
      </div>
      <div>
        <label>Service</label>
        <select name="service">
          <option value="">Select service‚Ä¶</option>
          <option>Loft Insulation</option>
          <option>Cavity Wall Insulation</option>
          <option>Underfloor Insulation</option>
          <option>Ventilation Upgrade</option>
          <option>Extractor Fan</option>
          <option>Spray Foam Removal</option>
        </select>
      </div>

      <!-- NEW STAFF FIELDS -->
      <div>
        <label>Booking Agent</label>
        <input name="booking_agent" placeholder="Agent name" />
      </div>
      <div>
        <label>Confirmer</label>
        <input name="confirmer" placeholder="Confirmed by" />
      </div>
      <div>
        <label>Sales Rep</label>
        <input name="sales_rep" placeholder="Rep name" />
      </div>

      <div style="grid-column:1/-1">
        <label>Notes</label>
        <textarea name="notes" placeholder="Any details to include on the contract‚Ä¶"></textarea>
      </div>
    </div>

    <div class="bar">
      <button class="btn" id="btnToContract">Open Contract (prefilled)</button>
      <button class="btn" id="btnWhatsAppContract" title="Sends a WhatsApp message with the contract link">
        üì≤ Send Contract Link via WhatsApp
      </button>
      <button class="btn secondary" id="btnClear">Clear</button>
    </div>
    <div class="note">Contract opens at <code>/Warmup-uk-app/contract.html</code> with all details prefilled. WhatsApp message includes a direct contract link.</div>
  </div>
</div>

<script>
  // ---------- Helpers ----------
  const enc = v => encodeURIComponent((v||'').trim());
  const get = sel => document.querySelector(sel);
  function formatUK(phoneRaw) {
    const d = (phoneRaw||'').replace(/\D/g,'');
    if (!d) return '';
    if (d.startsWith('44')) return d;
    if (d.startsWith('0'))  return '44' + d.slice(1);
    if (d.startsWith('7'))  return '44' + d;
    return d;
  }
  function readBooking() {
    return {
      name:    get('[name="name"]')?.value || '',
      phone:   get('[name="phone"]')?.value || '',
      address: get('[name="address"]')?.value || '',
      date:    get('[name="date"]')?.value || '',
      time:    get('[name="time"]')?.value || '',
      service: get('[name="service"]')?.value || '',
      // NEW staff fields
      booking_agent: get('[name="booking_agent"]')?.value || '',
      confirmer:     get('[name="confirmer"]')?.value || '',
      sales_rep:     get('[name="sales_rep"]')?.value || '',
      notes:   get('[name="notes"]')?.value || ''
    };
  }
  function saveBooking(b){
    localStorage.setItem('wu_latest_client', JSON.stringify(b));
  }

  // ---------- Open Contract (prefilled) ----------
  get('#btnToContract').addEventListener('click', () => {
    const b = readBooking();
    saveBooking(b);

    const url = `/Warmup-uk-app/contract.html?` +
      `name=${enc(b.name)}&phone=${enc(b.phone)}&address=${enc(b.address)}` +
      `&date=${enc(b.date)}&time=${enc(b.time)}&service=${enc(b.service)}` +
      `&booking_agent=${enc(b.booking_agent)}&confirmer=${enc(b.confirmer)}&sales_rep=${enc(b.sales_rep)}` +
      `&notes=${enc(b.notes)}&v=7`;

    window.location.href = url;
  });

  // ---------- WhatsApp: send Contract link (no price) ----------
  get('#btnWhatsAppContract').addEventListener('click', () => {
    const b = readBooking();
    saveBooking(b);

    const contractUrl = `/Warmup-uk-app/contract.html?` +
      `name=${enc(b.name)}&phone=${enc(b.phone)}&address=${enc(b.address)}` +
      `&date=${enc(b.date)}&time=${enc(b.time)}&service=${enc(b.service)}` +
      `&booking_agent=${enc(b.booking_agent)}&confirmer=${enc(b.confirmer)}&sales_rep=${enc(b.sales_rep)}` +
      `&notes=${enc(b.notes)}&v=7`;

    const lines = [
      `Warm Up UK ‚Äì Contract Link`,
      b.name ? `Name: ${b.name}` : null,
      b.service ? `Service: ${b.service}` : null,
      (b.date||b.time) ? `Appointment: ${[b.date,b.time].filter(Boolean).join(' ')}` : null,
      b.address ? `Address: ${b.address}` : null,
      b.booking_agent ? `Booking Agent: ${b.booking_agent}` : null,
      b.confirmer ? `Confirmer: ${b.confirmer}` : null,
      b.sales_rep ? `Sales Rep: ${b.sales_rep}` : null,
      b.notes ? `Notes: ${b.notes}` : null,
      ``,
      `Open your contract here:`,
      location.origin + contractUrl
    ].filter(Boolean).map(enc).join('%0A');

    const intl = formatUK(b.phone);
    if (!intl) { alert('Please enter a valid client WhatsApp number.'); return; }

    const wa = `https://wa.me/${intl}?text=${lines}`;
    window.open(wa, '_blank');
  });

  // ---------- Clear ----------
  get('#btnClear').addEventListener('click', () => {
    document.querySelectorAll('input, textarea, select').forEach(el => {
      if (el.tagName === 'SELECT') el.selectedIndex = 0; else el.value = '';
    });
  });
</script>
</body>
</html>
